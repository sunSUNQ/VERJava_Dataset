[{"cve_id": "CVE-2011-1183", "added_line": [{"target_line_num": 459, "target_line_code": "if (constraints == null && !context.getPreemptiveAuthentication()) {"}, {"target_line_num": 468, "target_line_code": "if (constraints != null && disableProxyCaching &&"}, {"target_line_num": 486, "target_line_code": "if (constraints != null) {"}, {"target_line_num": 489, "target_line_code": "log.debug(\" Calling hasUserDataPermission()\");"}, {"target_line_num": 491, "target_line_code": "if (!realm.hasUserDataPermission(request, response,"}, {"target_line_num": 492, "target_line_code": "constraints)) {"}, {"target_line_num": 488, "target_line_code": "if (log.isDebugEnabled()) {"}, {"target_line_num": 494, "target_line_code": "log.debug(\" Failed hasUserDataPermission() test\");"}, {"target_line_num": 496, "target_line_code": "/*"}, {"target_line_num": 500, "target_line_code": "return;"}, {"target_line_num": 506, "target_line_code": "boolean authRequired;"}, {"target_line_num": 507, "target_line_code": "if (constraints == null) {"}, {"target_line_num": 508, "target_line_code": "authRequired = false;"}, {"target_line_num": 509, "target_line_code": "} else {"}, {"target_line_num": 510, "target_line_code": "authRequired = true;"}, {"target_line_num": 511, "target_line_code": "for(i=0; i < constraints.length && authRequired; i++) {"}, {"target_line_num": 512, "target_line_code": "if(!constraints[i].getAuthConstraint()) {"}, {"target_line_num": 514, "target_line_code": "} else if(!constraints[i].getAllRoles()) {"}, {"target_line_num": 515, "target_line_code": "String [] roles = constraints[i].findAuthRoles();"}, {"target_line_num": 516, "target_line_code": "if(roles == null || roles.length == 0) {"}, {"target_line_num": 508, "target_line_code": "authRequired = false;"}, {"target_line_num": 523, "target_line_code": "if (!authRequired) {"}, {"target_line_num": 524, "target_line_code": "authRequired ="}, {"target_line_num": 525, "target_line_code": "request.getCoyoteRequest().getMimeHeaders().getValue("}, {"target_line_num": 526, "target_line_code": "\"authorization\") != null;"}, {"target_line_num": 523, "target_line_code": "if (!authRequired) {"}, {"target_line_num": 530, "target_line_code": "X509Certificate[] certs = (X509Certificate[]) request.getAttribute("}, {"target_line_num": 531, "target_line_code": "Globals.CERTIFICATES_ATTR);"}, {"target_line_num": 532, "target_line_code": "authRequired = certs != null && certs.length > 0;"}, {"target_line_num": 553, "target_line_code": "if (constraints != null) {"}, {"target_line_num": 555, "target_line_code": "log.debug(\" Calling accessControl()\");"}, {"target_line_num": 557, "target_line_code": "if (!realm.hasResourcePermission(request, response,"}, {"target_line_num": 558, "target_line_code": "constraints,"}, {"target_line_num": 559, "target_line_code": "this.context)) {"}, {"target_line_num": 554, "target_line_code": "if (log.isDebugEnabled()) {"}, {"target_line_num": 561, "target_line_code": "log.debug(\" Failed accessControl() test\");"}, {"target_line_num": 563, "target_line_code": "/*"}, {"target_line_num": 568, "target_line_code": "return;"}, {"target_line_num": 459, "target_line_code": "if (constraints == null && !context.getPreemptiveAuthentication()) {"}, {"target_line_num": 468, "target_line_code": "if (constraints != null && disableProxyCaching &&"}, {"target_line_num": 488, "target_line_code": "if (constraints != null) {"}, {"target_line_num": 489, "target_line_code": "log.debug(\" Calling hasUserDataPermission()\");"}, {"target_line_num": 491, "target_line_code": "if (!realm.hasUserDataPermission(request, response,"}, {"target_line_num": 492, "target_line_code": "constraints)) {"}, {"target_line_num": 495, "target_line_code": "if (log.isDebugEnabled()) {"}, {"target_line_num": 494, "target_line_code": "log.debug(\" Failed hasUserDataPermission() test\");"}, {"target_line_num": 498, "target_line_code": "/*"}, {"target_line_num": 502, "target_line_code": "return;"}, {"target_line_num": 506, "target_line_code": "boolean authRequired;"}, {"target_line_num": 507, "target_line_code": "if (constraints == null) {"}, {"target_line_num": 508, "target_line_code": "authRequired = false;"}, {"target_line_num": 509, "target_line_code": "} else {"}, {"target_line_num": 510, "target_line_code": "authRequired = true;"}, {"target_line_num": 511, "target_line_code": "for(i=0; i < constraints.length && authRequired; i++) {"}, {"target_line_num": 512, "target_line_code": "if(!constraints[i].getAuthConstraint()) {"}, {"target_line_num": 514, "target_line_code": "} else if(!constraints[i].getAllRoles()) {"}, {"target_line_num": 515, "target_line_code": "String [] roles = constraints[i].findAuthRoles();"}, {"target_line_num": 516, "target_line_code": "if(roles == null || roles.length == 0) {"}, {"target_line_num": 508, "target_line_code": "authRequired = false;"}, {"target_line_num": 523, "target_line_code": "if (!authRequired) {"}, {"target_line_num": 524, "target_line_code": "authRequired ="}, {"target_line_num": 525, "target_line_code": "request.getCoyoteRequest().getMimeHeaders().getValue("}, {"target_line_num": 526, "target_line_code": "\"authorization\") != null;"}, {"target_line_num": 523, "target_line_code": "if (!authRequired) {"}, {"target_line_num": 530, "target_line_code": "X509Certificate[] certs = (X509Certificate[]) request.getAttribute("}, {"target_line_num": 531, "target_line_code": "Globals.CERTIFICATES_ATTR);"}, {"target_line_num": 532, "target_line_code": "authRequired = certs != null && certs.length > 0;"}, {"target_line_num": 555, "target_line_code": "if (constraints != null) {"}, {"target_line_num": 555, "target_line_code": "log.debug(\" Calling accessControl()\");"}, {"target_line_num": 557, "target_line_code": "if (!realm.hasResourcePermission(request, response,"}, {"target_line_num": 558, "target_line_code": "constraints,"}, {"target_line_num": 559, "target_line_code": "this.context)) {"}, {"target_line_num": 562, "target_line_code": "if (log.isDebugEnabled()) {"}, {"target_line_num": 561, "target_line_code": "log.debug(\" Failed accessControl() test\");"}, {"target_line_num": 565, "target_line_code": "/*"}, {"target_line_num": 570, "target_line_code": "return;"}], "removed_line": [{"source_line_num": 459, "source_line_code": "if ((constraints == null) /* &&"}, {"source_line_num": 460, "source_line_code": "(!Constants.FORM_METHOD.equals(config.getAuthMethod())) */ ) {"}, {"source_line_num": 469, "source_line_code": "if (disableProxyCaching &&"}, {"source_line_num": 488, "source_line_code": "if (log.isDebugEnabled()) {"}, {"source_line_num": 489, "source_line_code": "log.debug(\" Calling hasUserDataPermission()\");"}, {"source_line_num": 491, "source_line_code": "if (!realm.hasUserDataPermission(request, response,"}, {"source_line_num": 492, "source_line_code": "constraints)) {"}, {"source_line_num": 494, "source_line_code": "log.debug(\" Failed hasUserDataPermission() test\");"}, {"source_line_num": 496, "source_line_code": "/*"}, {"source_line_num": 499, "source_line_code": "return;"}, {"source_line_num": 505, "source_line_code": "boolean authRequired = true;"}, {"source_line_num": 506, "source_line_code": "for(i=0; i < constraints.length && authRequired; i++) {"}, {"source_line_num": 507, "source_line_code": "if(!constraints[i].getAuthConstraint()) {"}, {"source_line_num": 508, "source_line_code": "authRequired = false;"}, {"source_line_num": 509, "source_line_code": "} else if(!constraints[i].getAllRoles()) {"}, {"source_line_num": 510, "source_line_code": "String [] roles = constraints[i].findAuthRoles();"}, {"source_line_num": 511, "source_line_code": "if(roles == null || roles.length == 0) {"}, {"source_line_num": 535, "source_line_code": "if (log.isDebugEnabled()) {"}, {"source_line_num": 536, "source_line_code": "log.debug(\" Calling accessControl()\");"}, {"source_line_num": 538, "source_line_code": "if (!realm.hasResourcePermission(request, response,"}, {"source_line_num": 539, "source_line_code": "constraints,"}, {"source_line_num": 540, "source_line_code": "this.context)) {"}, {"source_line_num": 542, "source_line_code": "log.debug(\" Failed accessControl() test\");"}, {"source_line_num": 544, "source_line_code": "/*"}, {"source_line_num": 549, "source_line_code": "return;"}, {"source_line_num": 500, "source_line_code": "return;"}], "filename": "archive/trunk/java/org/apache/catalina/authenticator/AuthenticatorBase.java", "patch_func": "invoke", "diff_file": "CVE-2011-1183_1087643.diff", "patch_tag": "7.0.12", "source_tag": "7.0.11"}]