[{"cve_id": "CVE-2009-2902", "added_line": [{"target_line_num": 228, "target_line_code": "public static void validate(Host host, URL war, String pathname)"}, {"target_line_num": 229, "target_line_code": "throws IOException {"}, {"target_line_num": 232, "target_line_code": "File appBase = new File(host.getAppBase());"}, {"target_line_num": 233, "target_line_code": "if (!appBase.isAbsolute()) {"}, {"target_line_num": 234, "target_line_code": "appBase = new File(System.getProperty(\"catalina.base\"),"}, {"target_line_num": 235, "target_line_code": "host.getAppBase());"}, {"target_line_num": 238, "target_line_code": "File docBase = new File(appBase, pathname);"}, {"target_line_num": 241, "target_line_code": "String canonicalDocBasePrefix = docBase.getCanonicalPath();"}, {"target_line_num": 242, "target_line_code": "if (!canonicalDocBasePrefix.endsWith(File.separator)) {"}, {"target_line_num": 243, "target_line_code": "canonicalDocBasePrefix += File.separator;"}, {"target_line_num": 245, "target_line_code": "JarURLConnection juc = (JarURLConnection) war.openConnection();"}, {"target_line_num": 246, "target_line_code": "juc.setUseCaches(false);"}, {"target_line_num": 247, "target_line_code": "JarFile jarFile = null;"}, {"target_line_num": 248, "target_line_code": "try {"}, {"target_line_num": 249, "target_line_code": "jarFile = juc.getJarFile();"}, {"target_line_num": 250, "target_line_code": "Enumeration<JarEntry> jarEntries = jarFile.entries();"}, {"target_line_num": 251, "target_line_code": "while (jarEntries.hasMoreElements()) {"}, {"target_line_num": 252, "target_line_code": "JarEntry jarEntry = jarEntries.nextElement();"}, {"target_line_num": 253, "target_line_code": "String name = jarEntry.getName();"}, {"target_line_num": 254, "target_line_code": "File expandedFile = new File(docBase, name);"}, {"target_line_num": 255, "target_line_code": "if (!expandedFile.getCanonicalPath().startsWith("}, {"target_line_num": 256, "target_line_code": "canonicalDocBasePrefix)) {"}, {"target_line_num": 259, "target_line_code": "throw new IllegalArgumentException("}, {"target_line_num": 260, "target_line_code": "sm.getString(\"expandWar.illegalPath\",war, name));"}, {"target_line_num": 263, "target_line_code": "} catch (IOException e) {"}, {"target_line_num": 264, "target_line_code": "throw e;"}, {"target_line_num": 265, "target_line_code": "} finally {"}, {"target_line_num": 266, "target_line_code": "if (jarFile != null) {"}, {"target_line_num": 267, "target_line_code": "try {"}, {"target_line_num": 268, "target_line_code": "jarFile.close();"}, {"target_line_num": 269, "target_line_code": "} catch (Throwable t) {"}, {"target_line_num": 272, "target_line_code": "jarFile = null;"}, {"target_line_num": 228, "target_line_code": "public static void validate(Host host, URL war, String pathname)"}, {"target_line_num": 229, "target_line_code": "throws IOException {"}, {"target_line_num": 232, "target_line_code": "File appBase = new File(host.getAppBase());"}, {"target_line_num": 233, "target_line_code": "if (!appBase.isAbsolute()) {"}, {"target_line_num": 234, "target_line_code": "appBase = new File(System.getProperty(\"catalina.base\"),"}, {"target_line_num": 235, "target_line_code": "host.getAppBase());"}, {"target_line_num": 238, "target_line_code": "File docBase = new File(appBase, pathname);"}, {"target_line_num": 241, "target_line_code": "String canonicalDocBasePrefix = docBase.getCanonicalPath();"}, {"target_line_num": 242, "target_line_code": "if (!canonicalDocBasePrefix.endsWith(File.separator)) {"}, {"target_line_num": 243, "target_line_code": "canonicalDocBasePrefix += File.separator;"}, {"target_line_num": 245, "target_line_code": "JarURLConnection juc = (JarURLConnection) war.openConnection();"}, {"target_line_num": 246, "target_line_code": "juc.setUseCaches(false);"}, {"target_line_num": 247, "target_line_code": "JarFile jarFile = null;"}, {"target_line_num": 250, "target_line_code": "try {"}, {"target_line_num": 249, "target_line_code": "jarFile = juc.getJarFile();"}, {"target_line_num": 250, "target_line_code": "Enumeration<JarEntry> jarEntries = jarFile.entries();"}, {"target_line_num": 251, "target_line_code": "while (jarEntries.hasMoreElements()) {"}, {"target_line_num": 252, "target_line_code": "JarEntry jarEntry = jarEntries.nextElement();"}, {"target_line_num": 253, "target_line_code": "String name = jarEntry.getName();"}, {"target_line_num": 254, "target_line_code": "File expandedFile = new File(docBase, name);"}, {"target_line_num": 255, "target_line_code": "if (!expandedFile.getCanonicalPath().startsWith("}, {"target_line_num": 256, "target_line_code": "canonicalDocBasePrefix)) {"}, {"target_line_num": 259, "target_line_code": "throw new IllegalArgumentException("}, {"target_line_num": 260, "target_line_code": "sm.getString(\"expandWar.illegalPath\",war, name));"}, {"target_line_num": 263, "target_line_code": "} catch (IOException e) {"}, {"target_line_num": 264, "target_line_code": "throw e;"}, {"target_line_num": 265, "target_line_code": "} finally {"}, {"target_line_num": 266, "target_line_code": "if (jarFile != null) {"}, {"target_line_num": 269, "target_line_code": "try {"}, {"target_line_num": 268, "target_line_code": "jarFile.close();"}, {"target_line_num": 269, "target_line_code": "} catch (Throwable t) {"}, {"target_line_num": 272, "target_line_code": "jarFile = null;"}], "removed_line": [], "filename": "archive/tc6.0.x/trunk/java/org/apache/catalina/startup/ExpandWar.java", "patch_func": "copy", "diff_file": "CVE-2009-2902_892815.diff", "patch_tag": "6.0.24", "source_tag": "6.0.20"}]