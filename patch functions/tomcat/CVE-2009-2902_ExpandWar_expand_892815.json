[{"cve_id": "CVE-2009-2902", "added_line": [{"target_line_num": 138, "target_line_code": "String canonicalDocBasePrefix = docBase.getCanonicalPath();"}, {"target_line_num": 139, "target_line_code": "if (!canonicalDocBasePrefix.endsWith(File.separator)) {"}, {"target_line_num": 140, "target_line_code": "canonicalDocBasePrefix += File.separator;"}, {"target_line_num": 146, "target_line_code": "boolean success = false;"}, {"target_line_num": 153, "target_line_code": "File expandedFile = new File(docBase, name);"}, {"target_line_num": 154, "target_line_code": "if (!expandedFile.getCanonicalPath().startsWith("}, {"target_line_num": 155, "target_line_code": "canonicalDocBasePrefix)) {"}, {"target_line_num": 158, "target_line_code": "throw new IllegalArgumentException("}, {"target_line_num": 159, "target_line_code": "sm.getString(\"expandWar.illegalPath\",war, name));"}, {"target_line_num": 173, "target_line_code": "expand(input, expandedFile);"}, {"target_line_num": 175, "target_line_code": "if ((lastModified != -1) && (lastModified != 0)) {"}, {"target_line_num": 182, "target_line_code": "success = true;"}, {"target_line_num": 186, "target_line_code": "if (!success) {"}, {"target_line_num": 189, "target_line_code": "deleteDir(docBase);"}, {"target_line_num": 439, "target_line_code": "File file = new File(docBase, name);"}, {"target_line_num": 440, "target_line_code": "expand(input, file);"}, {"target_line_num": 441, "target_line_code": "return file;"}, {"target_line_num": 453, "target_line_code": "private static void expand(InputStream input, File file)"}, {"target_line_num": 454, "target_line_code": "throws IOException {"}, {"target_line_num": 138, "target_line_code": "String canonicalDocBasePrefix = docBase.getCanonicalPath();"}, {"target_line_num": 139, "target_line_code": "if (!canonicalDocBasePrefix.endsWith(File.separator)) {"}, {"target_line_num": 140, "target_line_code": "canonicalDocBasePrefix += File.separator;"}, {"target_line_num": 146, "target_line_code": "boolean success = false;"}, {"target_line_num": 153, "target_line_code": "File expandedFile = new File(docBase, name);"}, {"target_line_num": 154, "target_line_code": "if (!expandedFile.getCanonicalPath().startsWith("}, {"target_line_num": 155, "target_line_code": "canonicalDocBasePrefix)) {"}, {"target_line_num": 158, "target_line_code": "throw new IllegalArgumentException("}, {"target_line_num": 159, "target_line_code": "sm.getString(\"expandWar.illegalPath\",war, name));"}, {"target_line_num": 173, "target_line_code": "expand(input, expandedFile);"}, {"target_line_num": 175, "target_line_code": "if ((lastModified != -1) && (lastModified != 0)) {"}, {"target_line_num": 182, "target_line_code": "success = true;"}, {"target_line_num": 186, "target_line_code": "if (!success) {"}, {"target_line_num": 189, "target_line_code": "deleteDir(docBase);"}, {"target_line_num": 439, "target_line_code": "File file = new File(docBase, name);"}, {"target_line_num": 440, "target_line_code": "expand(input, file);"}, {"target_line_num": 441, "target_line_code": "return file;"}, {"target_line_num": 453, "target_line_code": "private static void expand(InputStream input, File file)"}, {"target_line_num": 454, "target_line_code": "throws IOException {"}], "removed_line": [{"source_line_num": 158, "source_line_code": "File expandedFile = expand(input, docBase, name);"}, {"source_line_num": 160, "source_line_code": "if ((lastModified != -1) && (lastModified != 0) && (expandedFile != null)) {"}, {"source_line_num": 170, "source_line_code": "deleteDir(docBase);"}, {"source_line_num": 309, "source_line_code": "File file = new File(docBase, name);"}, {"source_line_num": 331, "source_line_code": "return file;"}, {"source_line_num": 158, "source_line_code": "File expandedFile = expand(input, docBase, name);"}, {"source_line_num": 160, "source_line_code": "if ((lastModified != -1) && (lastModified != 0) && (expandedFile != null)) {"}, {"source_line_num": 170, "source_line_code": "deleteDir(docBase);"}, {"source_line_num": 309, "source_line_code": "File file = new File(docBase, name);"}, {"source_line_num": 331, "source_line_code": "return file;"}], "filename": "archive/tc6.0.x/trunk/java/org/apache/catalina/startup/ExpandWar.java", "patch_func": "expand", "diff_file": "CVE-2009-2902_892815.diff", "patch_tag": "6.0.24", "source_tag": "6.0.20"}]