[{"cve_id": "jackson-databind", "added_line": [{"target_line_num": 2, "target_line_code": "package com.fasterxml.jackson.databind.jsontype.impl;"}, {"target_line_num": 4, "target_line_code": "import java.util.Collections;"}, {"target_line_num": 5, "target_line_code": "import java.util.HashSet;"}, {"target_line_num": 6, "target_line_code": "import java.util.Set;"}, {"target_line_num": 8, "target_line_code": "import com.fasterxml.jackson.databind.DeserializationContext;"}, {"target_line_num": 9, "target_line_code": "import com.fasterxml.jackson.databind.JavaType;"}, {"target_line_num": 10, "target_line_code": "import com.fasterxml.jackson.databind.JsonMappingException;"}, {"target_line_num": 12, "target_line_code": "/**"}, {"target_line_num": 13, "target_line_code": "* Helper class used to encapsulate rules that determine subtypes that"}, {"target_line_num": 14, "target_line_code": "* are invalid to use, even with default typing, mostly due to security"}, {"target_line_num": 15, "target_line_code": "* concerns."}, {"target_line_num": 16, "target_line_code": "* Used by <code>BeanDeserializerFacotry</code>"}, {"target_line_num": 17, "target_line_code": "*"}, {"target_line_num": 18, "target_line_code": "* @since 2.8.11"}, {"target_line_num": 19, "target_line_code": "*/"}, {"target_line_num": 20, "target_line_code": "public class SubTypeValidator"}, {"target_line_num": 21, "target_line_code": "{"}, {"target_line_num": 22, "target_line_code": "protected final static String PREFIX_STRING = \"org.springframework.\";"}, {"target_line_num": 23, "target_line_code": "/**"}, {"target_line_num": 24, "target_line_code": "* Set of well-known \"nasty classes\", deserialization of which is considered dangerous"}, {"target_line_num": 25, "target_line_code": "* and should (and is) prevented by default."}, {"target_line_num": 26, "target_line_code": "*/"}, {"target_line_num": 27, "target_line_code": "protected final static Set<String> DEFAULT_NO_DESER_CLASS_NAMES;"}, {"target_line_num": 28, "target_line_code": "static {"}, {"target_line_num": 29, "target_line_code": "Set<String> s = new HashSet<String>();"}, {"target_line_num": 32, "target_line_code": "s.add(\"org.apache.commons.collections.functors.InvokerTransformer\");"}, {"target_line_num": 33, "target_line_code": "s.add(\"org.apache.commons.collections.functors.InstantiateTransformer\");"}, {"target_line_num": 34, "target_line_code": "s.add(\"org.apache.commons.collections4.functors.InvokerTransformer\");"}, {"target_line_num": 35, "target_line_code": "s.add(\"org.apache.commons.collections4.functors.InstantiateTransformer\");"}, {"target_line_num": 36, "target_line_code": "s.add(\"org.codehaus.groovy.runtime.ConvertedClosure\");"}, {"target_line_num": 37, "target_line_code": "s.add(\"org.codehaus.groovy.runtime.MethodClosure\");"}, {"target_line_num": 38, "target_line_code": "s.add(\"org.springframework.beans.factory.ObjectFactory\");"}, {"target_line_num": 39, "target_line_code": "s.add(\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\");"}, {"target_line_num": 40, "target_line_code": "s.add(\"org.apache.xalan.xsltc.trax.TemplatesImpl\");"}, {"target_line_num": 42, "target_line_code": "s.add(\"com.sun.rowset.JdbcRowSetImpl\");"}, {"target_line_num": 44, "target_line_code": "s.add(\"java.util.logging.FileHandler\");"}, {"target_line_num": 45, "target_line_code": "s.add(\"java.rmi.server.UnicastRemoteObject\");"}, {"target_line_num": 48, "target_line_code": "s.add(\"org.springframework.beans.factory.config.PropertyPathFactoryBean\");"}, {"target_line_num": 49, "target_line_code": "s.add(\"com.mchange.v2.c3p0.JndiRefForwardingDataSource\");"}, {"target_line_num": 50, "target_line_code": "s.add(\"com.mchange.v2.c3p0.WrapperConnectionPoolDataSource\");"}, {"target_line_num": 52, "target_line_code": "s.add(\"org.apache.tomcat.dbcp.dbcp2.BasicDataSource\");"}, {"target_line_num": 53, "target_line_code": "s.add(\"com.sun.org.apache.bcel.internal.util.ClassLoader\");"}, {"target_line_num": 54, "target_line_code": "DEFAULT_NO_DESER_CLASS_NAMES = Collections.unmodifiableSet(s);"}, {"target_line_num": 57, "target_line_code": "/**"}, {"target_line_num": 58, "target_line_code": "* Set of class names of types that are never to be deserialized."}, {"target_line_num": 59, "target_line_code": "*/"}, {"target_line_num": 60, "target_line_code": "protected Set<String> _cfgIllegalClassNames = DEFAULT_NO_DESER_CLASS_NAMES;"}, {"target_line_num": 62, "target_line_code": "private final static SubTypeValidator instance = new SubTypeValidator();"}, {"target_line_num": 64, "target_line_code": "protected SubTypeValidator() { }"}, {"target_line_num": 66, "target_line_code": "public static SubTypeValidator instance() { return instance; }"}, {"target_line_num": 68, "target_line_code": "public void validateSubType(DeserializationContext ctxt, JavaType type) throws JsonMappingException"}, {"target_line_num": 69, "target_line_code": "{"}, {"target_line_num": 72, "target_line_code": "final Class<?> raw = type.getRawClass();"}, {"target_line_num": 73, "target_line_code": "String full = raw.getName();"}, {"target_line_num": 75, "target_line_code": "do {"}, {"target_line_num": 76, "target_line_code": "if (_cfgIllegalClassNames.contains(full)) {"}, {"target_line_num": 77, "target_line_code": "break;"}, {"target_line_num": 82, "target_line_code": "if (full.startsWith(PREFIX_STRING)) {"}, {"target_line_num": 83, "target_line_code": "for (Class<?> cls = raw; cls != Object.class; cls = cls.getSuperclass()) {"}, {"target_line_num": 84, "target_line_code": "String name = cls.getSimpleName();"}, {"target_line_num": 86, "target_line_code": "if (\"AbstractPointcutAdvisor\".equals(name)"}, {"target_line_num": 88, "target_line_code": "|| \"AbstractApplicationContext.equals\".equals(name)) {"}, {"target_line_num": 89, "target_line_code": "break;"}, {"target_line_num": 93, "target_line_code": "return;"}, {"target_line_num": 94, "target_line_code": "} while (false);"}, {"target_line_num": 96, "target_line_code": "throw JsonMappingException.from(ctxt,"}, {"target_line_num": 97, "target_line_code": "String.format(\"Illegal type (%s) to deserialize: prevented for security reasons\", full));"}], "removed_line": [], "filename": "src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java", "patch_func": "no", "diff_file": "jackson-databind_CVE-2017-17485_2235894210c75f624a3d0cd60bfb0434a20a18bf.diff", "patch_tag": "jackson-databind-2.9.9.3", "source_tag": "jackson-databind-2.9.9.2"}]