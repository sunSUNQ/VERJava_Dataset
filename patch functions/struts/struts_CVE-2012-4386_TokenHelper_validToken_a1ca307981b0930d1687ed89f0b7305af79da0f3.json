[{"cve_id": "struts", 
	"added_line": [
		{"target_line_num": 67, "target_line_code": "/**"}, 
		{"target_line_num": 68, "target_line_code": "* Sets a transaction token into the session based on the provided token name."}, 
		{"target_line_num": 69, "target_line_code": "*"}, 
		{"target_line_num": 70, "target_line_code": "* @param tokenName the token name based on which a generated token value is stored into session; for actual session"}, 
		{"target_line_num": 71, "target_line_code": "*                  store, this name will be prefixed by a namespace."}, 
		{"target_line_num": 72, "target_line_code": "*"}, 
		{"target_line_num": 73, "target_line_code": "* @return the token string"}, 
		{"target_line_num": 74, "target_line_code": "*/"}, 
		{"target_line_num": 75, "target_line_code": "public static String setToken( String tokenName ) {"}, 
		{"target_line_num": 76, "target_line_code": "String token = generateGUID();"}, {"target_line_num": 77, "target_line_code": "setSessionToken(tokenName, token);"}, {"target_line_num": 78, "target_line_code": "return token;"}, {"target_line_num": 81, "target_line_code": "/**"}, {"target_line_num": 82, "target_line_code": "* Put a given named token into the session map. The token will be stored with a namespace prefix prepended."}, {"target_line_num": 83, "target_line_code": "*"}, {"target_line_num": 84, "target_line_code": "* @param tokenName the token name based on which given token value is stored into session; for actual session store,"}, {"target_line_num": 85, "target_line_code": "*                  this name will be prefixed by a namespace."}, {"target_line_num": 86, "target_line_code": "* @param token     the token value to store"}, {"target_line_num": 87, "target_line_code": "*/"}, {"target_line_num": 88, "target_line_code": "public static void setSessionToken( String tokenName, String token ) {"}, {"target_line_num": 89, "target_line_code": "Map<String, Object> session = ActionContext.getContext().getSession();"}, {"target_line_num": 90, "target_line_code": "try {"}, {"target_line_num": 91, "target_line_code": "session.put(buildTokenSessionAttributeName(tokenName), token);"}, {"target_line_num": 92, "target_line_code": "} catch ( IllegalStateException e ) {"}, {"target_line_num": 94, "target_line_code": "String msg = \"Error creating HttpSession due response is commited to client. You can use the CreateSessionInterceptor or create the HttpSession from your action before the result is rendered to the client: \" + e.getMessage();"}, {"target_line_num": 95, "target_line_code": "LOG.error(msg, e);"}, {"target_line_num": 96, "target_line_code": "throw new IllegalArgumentException(msg);"}, {"target_line_num": 101, "target_line_code": "/**"}, {"target_line_num": 102, "target_line_code": "* Build a name-spaced token session attribute name based on the given token name."}, {"target_line_num": 103, "target_line_code": "*"}, {"target_line_num": 104, "target_line_code": "* @param tokenName the token name to prefix"}, {"target_line_num": 105, "target_line_code": "*"}, {"target_line_num": 106, "target_line_code": "* @return the name space prefixed session token name"}, {"target_line_num": 107, "target_line_code": "*/"}, {"target_line_num": 108, "target_line_code": "public static String buildTokenSessionAttributeName( String tokenName ) {"}, {"target_line_num": 109, "target_line_code": "return TOKEN_NAMESPACE + \".\" + tokenName;"}, {"target_line_num": 112, "target_line_code": "/**"}, {"target_line_num": 113, "target_line_code": "* Gets a transaction token from the params in the ServletActionContext using the default token name."}], "removed_line": [{"source_line_num": 62, "source_line_code": "/**"}, {"source_line_num": 63, "source_line_code": "* Sets a transaction token into the session using the provided token name."}, {"source_line_num": 64, "source_line_code": "*"}, {"source_line_num": 65, "source_line_code": "* @param tokenName the name to store into the session with the token as the value"}, {"source_line_num": 66, "source_line_code": "* @return the token string"}, {"source_line_num": 67, "source_line_code": "*/"}, {"source_line_num": 68, "source_line_code": "public static String setToken(String tokenName) {"}, {"source_line_num": 69, "source_line_code": "Map session = ActionContext.getContext().getSession();"}, {"source_line_num": 70, "source_line_code": "String token = generateGUID();"}, {"source_line_num": 71, "source_line_code": "try {"}, {"source_line_num": 72, "source_line_code": "session.put(tokenName, token);"}, {"source_line_num": 74, "source_line_code": "catch(IllegalStateException e) {"}, {"source_line_num": 76, "source_line_code": "String msg = \"Error creating HttpSession due response is commited to client. You can use the CreateSessionInterceptor or create the HttpSession from your action before the result is rendered to the client: \" + e.getMessage();"}, {"source_line_num": 77, "source_line_code": "LOG.error(msg, e);"}, {"source_line_num": 78, "source_line_code": "throw new IllegalArgumentException(msg);"}, {"source_line_num": 81, "source_line_code": "return token;"}, {"source_line_num": 85, "source_line_code": "/**"}, {"source_line_num": 86, "source_line_code": "* Gets a transaction token into the session using the default token name."}], "filename": "core/src/main/java/org/apache/struts2/util/TokenHelper.java", "patch_func": "no", "diff_file": "struts_CVE-2012-4386_a1ca307981b0930d1687ed89f0b7305af79da0f3.diff", "patch_tag": "STRUTS_6_0_0_RC1", "source_tag": "STRUTS_2_5_BETA3"}]