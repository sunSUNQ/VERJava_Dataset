[{"cve_id": "struts", "added_line": [{"target_line_num": 26, "target_line_code": "import com.opensymphony.xwork2.ModelDriven;"}, {"target_line_num": 28, "target_line_code": "import com.thoughtworks.xstream.security.ArrayTypePermission;"}, {"target_line_num": 29, "target_line_code": "import com.thoughtworks.xstream.security.ExplicitTypePermission;"}, {"target_line_num": 30, "target_line_code": "import com.thoughtworks.xstream.security.NoTypePermission;"}, {"target_line_num": 31, "target_line_code": "import com.thoughtworks.xstream.security.NullPermission;"}, {"target_line_num": 32, "target_line_code": "import com.thoughtworks.xstream.security.PrimitiveTypePermission;"}, {"target_line_num": 33, "target_line_code": "import com.thoughtworks.xstream.security.TypePermission;"}, {"target_line_num": 34, "target_line_code": "import org.apache.logging.log4j.LogManager;"}, {"target_line_num": 35, "target_line_code": "import org.apache.logging.log4j.Logger;"}, {"target_line_num": 40, "target_line_code": "import java.util.Collection;"}, {"target_line_num": 41, "target_line_code": "import java.util.Date;"}, {"target_line_num": 42, "target_line_code": "import java.util.Map;"}, {"target_line_num": 43, "target_line_code": "import java.util.Set;"}, {"target_line_num": 50, "target_line_code": "private static final Logger LOG = LogManager.getLogger(XStreamHandler.class);"}, {"target_line_num": 54, "target_line_code": "XStream xstream = createXStream(invocation);"}, {"target_line_num": 61, "target_line_code": "XStream xstream = createXStream(invocation);"}, {"target_line_num": 65, "target_line_code": "/**"}, {"target_line_num": 66, "target_line_code": "* @deprecated use version with {@link ActionInvocation}"}, {"target_line_num": 67, "target_line_code": "*/"}, {"target_line_num": 68, "target_line_code": "@Deprecated"}, {"target_line_num": 70, "target_line_code": "LOG.warn(\"You are using a deprecated API!\");"}, {"target_line_num": 74, "target_line_code": "protected XStream createXStream(ActionInvocation invocation) {"}, {"target_line_num": 75, "target_line_code": "XStream stream = new XStream();"}, {"target_line_num": 76, "target_line_code": "LOG.debug(\"Clears existing permissions\");"}, {"target_line_num": 77, "target_line_code": "stream.addPermission(NoTypePermission.NONE);"}, {"target_line_num": 79, "target_line_code": "LOG.debug(\"Adds per action permissions\");"}, {"target_line_num": 80, "target_line_code": "addPerActionPermission(invocation, stream);"}, {"target_line_num": 82, "target_line_code": "LOG.debug(\"Adds default permissions\");"}, {"target_line_num": 83, "target_line_code": "addDefaultPermissions(invocation, stream);"}, {"target_line_num": 84, "target_line_code": "return stream;"}, {"target_line_num": 87, "target_line_code": "private void addPerActionPermission(ActionInvocation invocation, XStream stream) {"}, {"target_line_num": 88, "target_line_code": "Object action = invocation.getAction();"}, {"target_line_num": 89, "target_line_code": "if (action instanceof AllowedClasses) {"}, {"target_line_num": 90, "target_line_code": "Set<Class<?>> allowedClasses = ((AllowedClasses) action).allowedClasses();"}, {"target_line_num": 91, "target_line_code": "stream.addPermission(new ExplicitTypePermission(allowedClasses.toArray(new Class[allowedClasses.size()])));"}, {"target_line_num": 93, "target_line_code": "if (action instanceof AllowedClassNames) {"}, {"target_line_num": 94, "target_line_code": "Set<String> allowedClassNames = ((AllowedClassNames) action).allowedClassNames();"}, {"target_line_num": 95, "target_line_code": "stream.addPermission(new ExplicitTypePermission(allowedClassNames.toArray(new String[allowedClassNames.size()])));"}, {"target_line_num": 97, "target_line_code": "if (action instanceof XStreamPermissionProvider) {"}, {"target_line_num": 98, "target_line_code": "Collection<TypePermission> permissions = ((XStreamPermissionProvider) action).getTypePermissions();"}, {"target_line_num": 99, "target_line_code": "for (TypePermission permission : permissions) {"}, {"target_line_num": 100, "target_line_code": "stream.addPermission(permission);"}, {"target_line_num": 105, "target_line_code": "protected void addDefaultPermissions(ActionInvocation invocation, XStream stream) {"}, {"target_line_num": 106, "target_line_code": "stream.addPermission(new ExplicitTypePermission(new Class[]{invocation.getAction().getClass()}));"}, {"target_line_num": 107, "target_line_code": "if (invocation.getAction() instanceof ModelDriven) {"}, {"target_line_num": 108, "target_line_code": "stream.addPermission(new ExplicitTypePermission(new Class[]{((ModelDriven) invocation.getAction()).getModel().getClass()}));"}, {"target_line_num": 110, "target_line_code": "stream.addPermission(NullPermission.NULL);"}, {"target_line_num": 111, "target_line_code": "stream.addPermission(PrimitiveTypePermission.PRIMITIVES);"}, {"target_line_num": 112, "target_line_code": "stream.addPermission(ArrayTypePermission.ARRAYS);"}, {"target_line_num": 113, "target_line_code": "stream.addPermission(CollectionTypePermission.COLLECTIONS);"}, {"target_line_num": 114, "target_line_code": "stream.addPermission(new ExplicitTypePermission(new Class[]{Date.class}));"}], "removed_line": [{"source_line_num": 39, "source_line_code": "XStream xstream = createXStream();"}, {"source_line_num": 46, "source_line_code": "XStream xstream = createXStream();"}], "filename": "plugins/rest/src/main/java/org/apache/struts2/rest/handler/XStreamHandler.java", "patch_func": "no", "diff_file": "struts_CVE-2017-9805_6dd6e5cfb7b5e020abffe7e8091bd63fe97c10af.diff", "patch_tag": "STRUTS_2_3_37", "source_tag": "STRUTS_2_3_36"}]