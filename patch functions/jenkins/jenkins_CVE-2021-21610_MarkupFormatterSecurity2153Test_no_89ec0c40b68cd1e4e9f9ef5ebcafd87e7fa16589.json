[{"cve_id": "jenkins", "added_line": [{"target_line_num": 2, "target_line_code": "package hudson.markup;"}, {"target_line_num": 4, "target_line_code": "import com.gargoylesoftware.htmlunit.HttpMethod;"}, {"target_line_num": 5, "target_line_code": "import com.gargoylesoftware.htmlunit.Page;"}, {"target_line_num": 6, "target_line_code": "import com.gargoylesoftware.htmlunit.WebRequest;"}, {"target_line_num": 7, "target_line_code": "import com.gargoylesoftware.htmlunit.WebResponse;"}, {"target_line_num": 8, "target_line_code": "import com.gargoylesoftware.htmlunit.html.HtmlPage;"}, {"target_line_num": 9, "target_line_code": "import org.junit.Rule;"}, {"target_line_num": 10, "target_line_code": "import org.junit.Test;"}, {"target_line_num": 11, "target_line_code": "import org.jvnet.hudson.test.JenkinsRule;"}, {"target_line_num": 13, "target_line_code": "import java.net.URL;"}, {"target_line_num": 15, "target_line_code": "import static org.hamcrest.Matchers.containsString;"}, {"target_line_num": 16, "target_line_code": "import static org.hamcrest.Matchers.not;"}, {"target_line_num": 17, "target_line_code": "import static org.junit.Assert.assertEquals;"}, {"target_line_num": 18, "target_line_code": "import static org.junit.Assert.assertThat;"}, {"target_line_num": 21, "target_line_code": "public class MarkupFormatterSecurity2153Test {"}, {"target_line_num": 23, "target_line_code": "@Rule"}, {"target_line_num": 24, "target_line_code": "public JenkinsRule j = new JenkinsRule();"}, {"target_line_num": 26, "target_line_code": "@Test"}, {"target_line_num": 27, "target_line_code": "public void security2153RequiresPOST() throws Exception {"}, {"target_line_num": 28, "target_line_code": "final JenkinsRule.WebClient wc = j.createWebClient();"}, {"target_line_num": 29, "target_line_code": "wc.setThrowExceptionOnFailingStatusCode(false);"}, {"target_line_num": 30, "target_line_code": "final HtmlPage htmlPage = wc.goTo(\"markupFormatter/previewDescription?text=lolwut\");"}, {"target_line_num": 31, "target_line_code": "final WebResponse response = htmlPage.getWebResponse();"}, {"target_line_num": 32, "target_line_code": "assertEquals(405, response.getStatusCode());"}, {"target_line_num": 33, "target_line_code": "assertThat(response.getContentAsString(), containsString(\"This endpoint now requires that POST requests are sent\"));"}, {"target_line_num": 34, "target_line_code": "assertThat(response.getContentAsString(), not(containsString(\"lolwut\")));"}, {"target_line_num": 37, "target_line_code": "@Test"}, {"target_line_num": 38, "target_line_code": "public void security2153SetsCSP() throws Exception {"}, {"target_line_num": 39, "target_line_code": "final JenkinsRule.WebClient wc = j.createWebClient();"}, {"target_line_num": 40, "target_line_code": "final Page htmlPage = wc.getPage(wc.addCrumb(new WebRequest(new URL(j.jenkins.getRootUrl() + \"/markupFormatter/previewDescription?text=lolwut\"), HttpMethod.POST)));"}, {"target_line_num": 41, "target_line_code": "final WebResponse response = htmlPage.getWebResponse();"}, {"target_line_num": 42, "target_line_code": "assertEquals(200, response.getStatusCode());"}, {"target_line_num": 43, "target_line_code": "assertThat(response.getContentAsString(), containsString(\"lolwut\"));"}, {"target_line_num": 44, "target_line_code": "assertThat(response.getResponseHeaderValue(\"Content-Security-Policy\"), containsString(\"default-src 'none';\"));"}, {"target_line_num": 45, "target_line_code": "assertThat(response.getResponseHeaderValue(\"X-Content-Security-Policy\"), containsString(\"default-src 'none';\"));"}, {"target_line_num": 46, "target_line_code": "assertThat(response.getResponseHeaderValue(\"X-WebKit-CSP\"), containsString(\"default-src 'none';\"));"}], "removed_line": [], "filename": "test/src/test/java/hudson/markup/MarkupFormatterSecurity2153Test.java", "patch_func": "no", "diff_file": "jenkins_CVE-2021-21610_89ec0c40b68cd1e4e9f9ef5ebcafd87e7fa16589.diff", "patch_tag": "jenkins-2.275", "source_tag": "jenkins-2.274"}]