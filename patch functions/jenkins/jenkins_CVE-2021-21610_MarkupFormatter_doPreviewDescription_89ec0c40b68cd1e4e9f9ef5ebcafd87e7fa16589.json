[{"cve_id": "jenkins", 
	"added_line": [{"target_line_num": 124, "target_line_code": "@POST"}, {"target_line_num": 128, "target_line_code": "Map<String, String> extraHeaders = Collections.emptyMap();"}, {"target_line_num": 129, "target_line_code": "if (PREVIEWS_SET_CSP) {"}, {"target_line_num": 130, "target_line_code": "extraHeaders = Stream.of(\"Content-Security-Policy\", \"X-WebKit-CSP\", \"X-Content-Security-Policy\").collect(Collectors.toMap(Function.identity(), v -> \"default-src 'none';\"));"}, {"target_line_num": 132, "target_line_code": "return html(200, w.toString(), extraHeaders);"}, {"target_line_num": 135, "target_line_code": "/**"}, {"target_line_num": 136, "target_line_code": "* Handle GET requests sent to the /previewDescription URL."}, {"target_line_num": 137, "target_line_code": "* @return an HTTP response informing users that requests need to be sent via POST"}, {"target_line_num": 138, "target_line_code": "*/"}, {"target_line_num": 139, "target_line_code": "@GET"}, {"target_line_num": 140, "target_line_code": "@WebMethod(name = \"previewDescription\")"}, {"target_line_num": 141, "target_line_code": "@Restricted(NoExternalUse.class)"}, {"target_line_num": 142, "target_line_code": "public HttpResponse previewsNowNeedPostForSecurity2153(@QueryParameter String text, StaplerRequest req) throws IOException {"}, {"target_line_num": 143, "target_line_code": "LOGGER.log(Level.FINE, \"Received a GET request at \" + req.getRequestURL());"}, {"target_line_num": 144, "target_line_code": "if (PREVIEWS_ALLOW_GET) {"}, {"target_line_num": 145, "target_line_code": "return doPreviewDescription(text);"}, {"target_line_num": 147, "target_line_code": "return html(405, \"This endpoint now requires that POST requests are sent. Update the component implementing this preview feature.\", Collections.emptyMap());"}, {"target_line_num": 150, "target_line_code": "/**"}, {"target_line_num": 151, "target_line_code": "* Returns a basic HTML response with the provided status and additional headers set"}, {"target_line_num": 152, "target_line_code": "* @param status the HTTP status code"}, {"target_line_num": 153, "target_line_code": "* @param html the HTML response body"}, {"target_line_num": 154, "target_line_code": "* @param headers the additional headers to set"}, {"target_line_num": 155, "target_line_code": "* @return the response"}, {"target_line_num": 156, "target_line_code": "*/"}, {"target_line_num": 157, "target_line_code": "private static HttpResponse html(int status, @NonNull String html, @NonNull Map<String, String> headers) {"}, {"target_line_num": 159, "target_line_code": "return (req, rsp, node) -> {"}, {"target_line_num": 160, "target_line_code": "rsp.setContentType(\"text/html;charset=UTF-8\");"}, {"target_line_num": 161, "target_line_code": "rsp.setStatus(status);"}, {"target_line_num": 162, "target_line_code": "for (Map.Entry<String, String> header : headers.entrySet()) {"}, {"target_line_num": 163, "target_line_code": "rsp.setHeader(header.getKey(), header.getValue());"}, {"target_line_num": 165, "target_line_code": "PrintWriter pw = rsp.getWriter();"}, {"target_line_num": 166, "target_line_code": "pw.print(html);"}, {"target_line_num": 167, "target_line_code": "pw.flush();"}, {"target_line_num": 168, "target_line_code": "};"}], 
	"removed_line": [{"source_line_num": 106, "source_line_code": "return HttpResponses.html(w.toString());"}], "filename": "core/src/main/java/hudson/markup/MarkupFormatter.java", "patch_func": "doPreviewDescription", "diff_file": "jenkins_CVE-2021-21610_89ec0c40b68cd1e4e9f9ef5ebcafd87e7fa16589.diff", "patch_tag": "jenkins-2.275", "source_tag": "jenkins-2.274"}]