[{"cve_id": "jenkins", "added_line": [{"target_line_num": 52, "target_line_code": "import java.nio.file.DirectoryStream;"}, {"target_line_num": 53, "target_line_code": "import java.nio.file.Files;"}, {"target_line_num": 54, "target_line_code": "import java.nio.file.InvalidPathException;"}, {"target_line_num": 55, "target_line_code": "import java.nio.file.Path;"}, {"target_line_num": 473, "target_line_code": "File unsanitizedLegacyConfigFile = getUnsanitizedLegacyConfigFileFor(id);"}, {"target_line_num": 474, "target_line_code": "if (unsanitizedLegacyConfigFile.exists() && !unsanitizedLegacyConfigFile.equals(configFile)) {"}, {"target_line_num": 475, "target_line_code": "File ancestor = unsanitizedLegacyConfigFile.getParentFile();"}, {"target_line_num": 476, "target_line_code": "if (!configFile.exists()) {"}, {"target_line_num": 477, "target_line_code": "try {"}, {"target_line_num": 478, "target_line_code": "Files.createDirectory(configFile.getParentFile().toPath());"}, {"target_line_num": 479, "target_line_code": "Files.move(unsanitizedLegacyConfigFile.toPath(), configFile.toPath());"}, {"target_line_num": 480, "target_line_code": "} catch (IOException | InvalidPathException e) {"}, {"target_line_num": 481, "target_line_code": "LOGGER.log("}, {"target_line_num": 482, "target_line_code": "Level.WARNING,"}, {"target_line_num": 483, "target_line_code": "String.format(\"Failed to migrate user record from %s to %s, see SECURITY-499 for more information\", idStrategy().legacyFilenameOf(id), idStrategy().filenameOf(id)),"}, {"target_line_num": 484, "target_line_code": "e);"}, {"target_line_num": 490, "target_line_code": "File tmp = ancestor;"}, {"target_line_num": 491, "target_line_code": "try {"}, {"target_line_num": 492, "target_line_code": "while (!ancestor.equals(getRootDir())) {"}, {"target_line_num": 493, "target_line_code": "try (DirectoryStream<Path> stream = Files.newDirectoryStream(ancestor.toPath())) {"}, {"target_line_num": 494, "target_line_code": "if (!stream.iterator().hasNext()) {"}, {"target_line_num": 495, "target_line_code": "tmp = ancestor;"}, {"target_line_num": 496, "target_line_code": "ancestor = tmp.getParentFile();"}, {"target_line_num": 497, "target_line_code": "Files.deleteIfExists(tmp.toPath());"}, {"target_line_num": 498, "target_line_code": "} else {"}, {"target_line_num": 499, "target_line_code": "break;"}, {"target_line_num": 503, "target_line_code": "} catch (IOException | InvalidPathException e) {"}, {"target_line_num": 504, "target_line_code": "if (LOGGER.isLoggable(Level.FINE)) {"}, {"target_line_num": 505, "target_line_code": "LOGGER.log(Level.FINE, \"Could not delete \" + tmp + \" when cleaning up legacy user directories\", e);"}], "removed_line": [], "filename": "core/src/main/java/hudson/model/User.java", "patch_func": "no", "diff_file": "jenkins_CVE-2017-1000391_566a8ddb885f0bef9bc848e60455c0aabbf0c1d3.diff", "patch_tag": "jenkins-2.100", "source_tag": "jenkins-2.99"}]