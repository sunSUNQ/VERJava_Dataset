[{"cve_id": "liferay-portal", "added_line": [{"target_line_num": 37, "target_line_code": "import com.liferay.portal.kernel.util.StringUtil;"}, {"target_line_num": 52, "target_line_code": "import java.util.Collections;"}, {"target_line_num": 2822, "target_line_code": "private FinderPath _finderPathFetchByKII_C_U;"}, {"target_line_num": 2823, "target_line_code": "private FinderPath _finderPathCountByKII_C_U;"}, {"target_line_num": 2825, "target_line_code": "/**"}, {"target_line_num": 2826, "target_line_code": "* Returns the kaleo instance where kaleoInstanceId = &#63; and companyId = &#63; and userId = &#63; or throws a <code>NoSuchInstanceException</code> if it could not be found."}, {"target_line_num": 2827, "target_line_code": "*"}, {"target_line_num": 2828, "target_line_code": "* @param kaleoInstanceId the kaleo instance ID"}, {"target_line_num": 2829, "target_line_code": "* @param companyId the company ID"}, {"target_line_num": 2830, "target_line_code": "* @param userId the user ID"}, {"target_line_num": 2831, "target_line_code": "* @return the matching kaleo instance"}, {"target_line_num": 2832, "target_line_code": "* @throws NoSuchInstanceException if a matching kaleo instance could not be found"}, {"target_line_num": 2833, "target_line_code": "*/"}, {"target_line_num": 2834, "target_line_code": "@Override"}, {"target_line_num": 2835, "target_line_code": "public KaleoInstance findByKII_C_U("}, {"target_line_num": 2836, "target_line_code": "long kaleoInstanceId, long companyId, long userId)"}, {"target_line_num": 2837, "target_line_code": "throws NoSuchInstanceException {"}, {"target_line_num": 2839, "target_line_code": "KaleoInstance kaleoInstance = fetchByKII_C_U("}, {"target_line_num": 2840, "target_line_code": "kaleoInstanceId, companyId, userId);"}, {"target_line_num": 2842, "target_line_code": "if (kaleoInstance == null) {"}, {"target_line_num": 2843, "target_line_code": "StringBundler sb = new StringBundler(8);"}, {"target_line_num": 2845, "target_line_code": "sb.append(_NO_SUCH_ENTITY_WITH_KEY);"}, {"target_line_num": 2847, "target_line_code": "sb.append(\"kaleoInstanceId=\");"}, {"target_line_num": 2848, "target_line_code": "sb.append(kaleoInstanceId);"}, {"target_line_num": 2850, "target_line_code": "sb.append(\", companyId=\");"}, {"target_line_num": 2851, "target_line_code": "sb.append(companyId);"}, {"target_line_num": 2853, "target_line_code": "sb.append(\", userId=\");"}, {"target_line_num": 2854, "target_line_code": "sb.append(userId);"}, {"target_line_num": 2856, "target_line_code": "sb.append(\"}\");"}, {"target_line_num": 2858, "target_line_code": "if (_log.isDebugEnabled()) {"}, {"target_line_num": 2859, "target_line_code": "_log.debug(sb.toString());"}, {"target_line_num": 2862, "target_line_code": "throw new NoSuchInstanceException(sb.toString());"}, {"target_line_num": 2865, "target_line_code": "return kaleoInstance;"}, {"target_line_num": 2868, "target_line_code": "/**"}, {"target_line_num": 2869, "target_line_code": "* Returns the kaleo instance where kaleoInstanceId = &#63; and companyId = &#63; and userId = &#63; or returns <code>null</code> if it could not be found. Uses the finder cache."}, {"target_line_num": 2870, "target_line_code": "*"}, {"target_line_num": 2871, "target_line_code": "* @param kaleoInstanceId the kaleo instance ID"}, {"target_line_num": 2872, "target_line_code": "* @param companyId the company ID"}, {"target_line_num": 2873, "target_line_code": "* @param userId the user ID"}, {"target_line_num": 2874, "target_line_code": "* @return the matching kaleo instance, or <code>null</code> if a matching kaleo instance could not be found"}, {"target_line_num": 2875, "target_line_code": "*/"}, {"target_line_num": 2876, "target_line_code": "@Override"}, {"target_line_num": 2877, "target_line_code": "public KaleoInstance fetchByKII_C_U("}, {"target_line_num": 2878, "target_line_code": "long kaleoInstanceId, long companyId, long userId) {"}, {"target_line_num": 2880, "target_line_code": "return fetchByKII_C_U(kaleoInstanceId, companyId, userId, true);"}, {"target_line_num": 2883, "target_line_code": "/**"}, {"target_line_num": 2884, "target_line_code": "* Returns the kaleo instance where kaleoInstanceId = &#63; and companyId = &#63; and userId = &#63; or returns <code>null</code> if it could not be found, optionally using the finder cache."}, {"target_line_num": 2885, "target_line_code": "*"}, {"target_line_num": 2886, "target_line_code": "* @param kaleoInstanceId the kaleo instance ID"}, {"target_line_num": 2887, "target_line_code": "* @param companyId the company ID"}, {"target_line_num": 2888, "target_line_code": "* @param userId the user ID"}, {"target_line_num": 2889, "target_line_code": "* @param useFinderCache whether to use the finder cache"}, {"target_line_num": 2890, "target_line_code": "* @return the matching kaleo instance, or <code>null</code> if a matching kaleo instance could not be found"}, {"target_line_num": 2891, "target_line_code": "*/"}, {"target_line_num": 2892, "target_line_code": "@Override"}, {"target_line_num": 2893, "target_line_code": "public KaleoInstance fetchByKII_C_U("}, {"target_line_num": 2894, "target_line_code": "long kaleoInstanceId, long companyId, long userId,"}, {"target_line_num": 2895, "target_line_code": "boolean useFinderCache) {"}, {"target_line_num": 2897, "target_line_code": "Object[] finderArgs = null;"}, {"target_line_num": 2899, "target_line_code": "if (useFinderCache) {"}, {"target_line_num": 2900, "target_line_code": "finderArgs = new Object[] {kaleoInstanceId, companyId, userId};"}, {"target_line_num": 2903, "target_line_code": "Object result = null;"}, {"target_line_num": 2905, "target_line_code": "if (useFinderCache) {"}, {"target_line_num": 2906, "target_line_code": "result = finderCache.getResult("}, {"target_line_num": 2907, "target_line_code": "_finderPathFetchByKII_C_U, finderArgs, this);"}, {"target_line_num": 2910, "target_line_code": "if (result instanceof KaleoInstance) {"}, {"target_line_num": 2911, "target_line_code": "KaleoInstance kaleoInstance = (KaleoInstance)result;"}, {"target_line_num": 2913, "target_line_code": "if ((kaleoInstanceId != kaleoInstance.getKaleoInstanceId()) ||"}, {"target_line_num": 2914, "target_line_code": "(companyId != kaleoInstance.getCompanyId()) ||"}, {"target_line_num": 2915, "target_line_code": "(userId != kaleoInstance.getUserId())) {"}, {"target_line_num": 2917, "target_line_code": "result = null;"}, {"target_line_num": 2921, "target_line_code": "if (result == null) {"}, {"target_line_num": 2922, "target_line_code": "StringBundler sb = new StringBundler(5);"}, {"target_line_num": 2924, "target_line_code": "sb.append(_SQL_SELECT_KALEOINSTANCE_WHERE);"}, {"target_line_num": 2926, "target_line_code": "sb.append(_FINDER_COLUMN_KII_C_U_KALEOINSTANCEID_2);"}, {"target_line_num": 2928, "target_line_code": "sb.append(_FINDER_COLUMN_KII_C_U_COMPANYID_2);"}, {"target_line_num": 2930, "target_line_code": "sb.append(_FINDER_COLUMN_KII_C_U_USERID_2);"}, {"target_line_num": 2932, "target_line_code": "String sql = sb.toString();"}, {"target_line_num": 2934, "target_line_code": "Session session = null;"}, {"target_line_num": 2936, "target_line_code": "try {"}, {"target_line_num": 2937, "target_line_code": "session = openSession();"}, {"target_line_num": 2939, "target_line_code": "Query query = session.createQuery(sql);"}, {"target_line_num": 2941, "target_line_code": "QueryPos queryPos = QueryPos.getInstance(query);"}, {"target_line_num": 2943, "target_line_code": "queryPos.add(kaleoInstanceId);"}, {"target_line_num": 2945, "target_line_code": "queryPos.add(companyId);"}, {"target_line_num": 2947, "target_line_code": "queryPos.add(userId);"}, {"target_line_num": 2949, "target_line_code": "List<KaleoInstance> list = query.list();"}, {"target_line_num": 2951, "target_line_code": "if (list.isEmpty()) {"}, {"target_line_num": 2952, "target_line_code": "if (useFinderCache) {"}, {"target_line_num": 2953, "target_line_code": "finderCache.putResult("}, {"target_line_num": 2954, "target_line_code": "_finderPathFetchByKII_C_U, finderArgs, list);"}, {"target_line_num": 2957, "target_line_code": "else {"}, {"target_line_num": 2958, "target_line_code": "if (list.size() > 1) {"}, {"target_line_num": 2959, "target_line_code": "Collections.sort(list, Collections.reverseOrder());"}, {"target_line_num": 2961, "target_line_code": "if (_log.isWarnEnabled()) {"}, {"target_line_num": 2962, "target_line_code": "if (!useFinderCache) {"}, {"target_line_num": 2963, "target_line_code": "finderArgs = new Object[] {"}, {"target_line_num": 2964, "target_line_code": "kaleoInstanceId, companyId, userId"}, {"target_line_num": 2965, "target_line_code": "};"}, {"target_line_num": 2968, "target_line_code": "_log.warn("}, {"target_line_num": 2969, "target_line_code": "\"KaleoInstancePersistenceImpl.fetchByKII_C_U(long, long, long, boolean) with parameters (\" +"}, {"target_line_num": 2970, "target_line_code": "StringUtil.merge(finderArgs) +"}, {"target_line_num": 2971, "target_line_code": "\") yields a result set with more than 1 result. This violates the logical unique restriction. There is no order guarantee on which result is returned by this finder.\");"}, {"target_line_num": 2975, "target_line_code": "KaleoInstance kaleoInstance = list.get(0);"}, {"target_line_num": 2977, "target_line_code": "result = kaleoInstance;"}, {"target_line_num": 2979, "target_line_code": "cacheResult(kaleoInstance);"}, {"target_line_num": 2982, "target_line_code": "catch (Exception exception) {"}, {"target_line_num": 2983, "target_line_code": "if (useFinderCache) {"}, {"target_line_num": 2984, "target_line_code": "finderCache.removeResult("}, {"target_line_num": 2985, "target_line_code": "_finderPathFetchByKII_C_U, finderArgs);"}, {"target_line_num": 2988, "target_line_code": "throw processException(exception);"}, {"target_line_num": 2990, "target_line_code": "finally {"}, {"target_line_num": 2991, "target_line_code": "closeSession(session);"}, {"target_line_num": 2995, "target_line_code": "if (result instanceof List<?>) {"}, {"target_line_num": 2996, "target_line_code": "return null;"}, {"target_line_num": 2998, "target_line_code": "else {"}, {"target_line_num": 2999, "target_line_code": "return (KaleoInstance)result;"}, {"target_line_num": 3003, "target_line_code": "/**"}, {"target_line_num": 3004, "target_line_code": "* Removes the kaleo instance where kaleoInstanceId = &#63; and companyId = &#63; and userId = &#63; from the database."}, {"target_line_num": 3005, "target_line_code": "*"}, {"target_line_num": 3006, "target_line_code": "* @param kaleoInstanceId the kaleo instance ID"}, {"target_line_num": 3007, "target_line_code": "* @param companyId the company ID"}, {"target_line_num": 3008, "target_line_code": "* @param userId the user ID"}, {"target_line_num": 3009, "target_line_code": "* @return the kaleo instance that was removed"}, {"target_line_num": 3010, "target_line_code": "*/"}, {"target_line_num": 3011, "target_line_code": "@Override"}, {"target_line_num": 3012, "target_line_code": "public KaleoInstance removeByKII_C_U("}, {"target_line_num": 3013, "target_line_code": "long kaleoInstanceId, long companyId, long userId)"}, {"target_line_num": 3014, "target_line_code": "throws NoSuchInstanceException {"}, {"target_line_num": 3016, "target_line_code": "KaleoInstance kaleoInstance = findByKII_C_U("}, {"target_line_num": 3017, "target_line_code": "kaleoInstanceId, companyId, userId);"}, {"target_line_num": 3019, "target_line_code": "return remove(kaleoInstance);"}, {"target_line_num": 3022, "target_line_code": "/**"}, {"target_line_num": 3023, "target_line_code": "* Returns the number of kaleo instances where kaleoInstanceId = &#63; and companyId = &#63; and userId = &#63;."}, {"target_line_num": 3024, "target_line_code": "*"}, {"target_line_num": 3025, "target_line_code": "* @param kaleoInstanceId the kaleo instance ID"}, {"target_line_num": 3026, "target_line_code": "* @param companyId the company ID"}, {"target_line_num": 3027, "target_line_code": "* @param userId the user ID"}, {"target_line_num": 3028, "target_line_code": "* @return the number of matching kaleo instances"}, {"target_line_num": 3029, "target_line_code": "*/"}, {"target_line_num": 3030, "target_line_code": "@Override"}, {"target_line_num": 3031, "target_line_code": "public int countByKII_C_U("}, {"target_line_num": 3032, "target_line_code": "long kaleoInstanceId, long companyId, long userId) {"}, {"target_line_num": 3034, "target_line_code": "FinderPath finderPath = _finderPathCountByKII_C_U;"}, {"target_line_num": 3036, "target_line_code": "Object[] finderArgs = new Object[] {kaleoInstanceId, companyId, userId};"}, {"target_line_num": 3038, "target_line_code": "Long count = (Long)finderCache.getResult(finderPath, finderArgs, this);"}, {"target_line_num": 3040, "target_line_code": "if (count == null) {"}, {"target_line_num": 3041, "target_line_code": "StringBundler sb = new StringBundler(4);"}, {"target_line_num": 3043, "target_line_code": "sb.append(_SQL_COUNT_KALEOINSTANCE_WHERE);"}, {"target_line_num": 3045, "target_line_code": "sb.append(_FINDER_COLUMN_KII_C_U_KALEOINSTANCEID_2);"}, {"target_line_num": 3047, "target_line_code": "sb.append(_FINDER_COLUMN_KII_C_U_COMPANYID_2);"}, {"target_line_num": 3049, "target_line_code": "sb.append(_FINDER_COLUMN_KII_C_U_USERID_2);"}, {"target_line_num": 3051, "target_line_code": "String sql = sb.toString();"}, {"target_line_num": 3053, "target_line_code": "Session session = null;"}, {"target_line_num": 3055, "target_line_code": "try {"}, {"target_line_num": 3056, "target_line_code": "session = openSession();"}, {"target_line_num": 3058, "target_line_code": "Query query = session.createQuery(sql);"}, {"target_line_num": 3060, "target_line_code": "QueryPos queryPos = QueryPos.getInstance(query);"}, {"target_line_num": 3062, "target_line_code": "queryPos.add(kaleoInstanceId);"}, {"target_line_num": 3064, "target_line_code": "queryPos.add(companyId);"}, {"target_line_num": 3066, "target_line_code": "queryPos.add(userId);"}, {"target_line_num": 3068, "target_line_code": "count = (Long)query.uniqueResult();"}, {"target_line_num": 3070, "target_line_code": "finderCache.putResult(finderPath, finderArgs, count);"}, {"target_line_num": 3072, "target_line_code": "catch (Exception exception) {"}, {"target_line_num": 3073, "target_line_code": "finderCache.removeResult(finderPath, finderArgs);"}, {"target_line_num": 3075, "target_line_code": "throw processException(exception);"}, {"target_line_num": 3077, "target_line_code": "finally {"}, {"target_line_num": 3078, "target_line_code": "closeSession(session);"}, {"target_line_num": 3082, "target_line_code": "return count.intValue();"}, {"target_line_num": 3085, "target_line_code": "private static final String _FINDER_COLUMN_KII_C_U_KALEOINSTANCEID_2 ="}, {"target_line_num": 3086, "target_line_code": "\"kaleoInstance.kaleoInstanceId = ? AND \";"}, {"target_line_num": 3088, "target_line_code": "private static final String _FINDER_COLUMN_KII_C_U_COMPANYID_2 ="}, {"target_line_num": 3089, "target_line_code": "\"kaleoInstance.companyId = ? AND \";"}, {"target_line_num": 3091, "target_line_code": "private static final String _FINDER_COLUMN_KII_C_U_USERID_2 ="}, {"target_line_num": 3092, "target_line_code": "\"kaleoInstance.userId = ?\";"}, {"target_line_num": 3849, "target_line_code": "finderCache.putResult("}, {"target_line_num": 3850, "target_line_code": "_finderPathFetchByKII_C_U,"}, {"target_line_num": 3851, "target_line_code": "new Object[] {"}, {"target_line_num": 3852, "target_line_code": "kaleoInstance.getKaleoInstanceId(),"}, {"target_line_num": 3853, "target_line_code": "kaleoInstance.getCompanyId(), kaleoInstance.getUserId()"}, {"target_line_num": 3854, "target_line_code": "},"}, {"target_line_num": 3855, "target_line_code": "kaleoInstance);"}, {"target_line_num": 3912, "target_line_code": "clearUniqueFindersCache((KaleoInstanceModelImpl)kaleoInstance, true);"}, {"target_line_num": 3925, "target_line_code": "clearUniqueFindersCache("}, {"target_line_num": 3926, "target_line_code": "(KaleoInstanceModelImpl)kaleoInstance, true);"}, {"target_line_num": 3942, "target_line_code": "protected void cacheUniqueFindersCache("}, {"target_line_num": 3943, "target_line_code": "KaleoInstanceModelImpl kaleoInstanceModelImpl) {"}, {"target_line_num": 3945, "target_line_code": "Object[] args = new Object[] {"}, {"target_line_num": 3946, "target_line_code": "kaleoInstanceModelImpl.getKaleoInstanceId(),"}, {"target_line_num": 3947, "target_line_code": "kaleoInstanceModelImpl.getCompanyId(),"}, {"target_line_num": 3948, "target_line_code": "kaleoInstanceModelImpl.getUserId()"}, {"target_line_num": 3949, "target_line_code": "};"}, {"target_line_num": 3951, "target_line_code": "finderCache.putResult("}, {"target_line_num": 3952, "target_line_code": "_finderPathCountByKII_C_U, args, Long.valueOf(1), false);"}, {"target_line_num": 3953, "target_line_code": "finderCache.putResult("}, {"target_line_num": 3954, "target_line_code": "_finderPathFetchByKII_C_U, args, kaleoInstanceModelImpl, false);"}, {"target_line_num": 3957, "target_line_code": "protected void clearUniqueFindersCache("}, {"target_line_num": 3958, "target_line_code": "KaleoInstanceModelImpl kaleoInstanceModelImpl, boolean clearCurrent) {"}, {"target_line_num": 3960, "target_line_code": "if (clearCurrent) {"}, {"target_line_num": 3961, "target_line_code": "Object[] args = new Object[] {"}, {"target_line_num": 3962, "target_line_code": "kaleoInstanceModelImpl.getKaleoInstanceId(),"}, {"target_line_num": 3963, "target_line_code": "kaleoInstanceModelImpl.getCompanyId(),"}, {"target_line_num": 3964, "target_line_code": "kaleoInstanceModelImpl.getUserId()"}, {"target_line_num": 3965, "target_line_code": "};"}, {"target_line_num": 3967, "target_line_code": "finderCache.removeResult(_finderPathCountByKII_C_U, args);"}, {"target_line_num": 3968, "target_line_code": "finderCache.removeResult(_finderPathFetchByKII_C_U, args);"}, {"target_line_num": 3971, "target_line_code": "if ((kaleoInstanceModelImpl.getColumnBitmask() &"}, {"target_line_num": 3972, "target_line_code": "_finderPathFetchByKII_C_U.getColumnBitmask()) != 0) {"}, {"target_line_num": 3974, "target_line_code": "Object[] args = new Object[] {"}, {"target_line_num": 3975, "target_line_code": "kaleoInstanceModelImpl.getOriginalKaleoInstanceId(),"}, {"target_line_num": 3976, "target_line_code": "kaleoInstanceModelImpl.getOriginalCompanyId(),"}, {"target_line_num": 3977, "target_line_code": "kaleoInstanceModelImpl.getOriginalUserId()"}, {"target_line_num": 3978, "target_line_code": "};"}, {"target_line_num": 3980, "target_line_code": "finderCache.removeResult(_finderPathCountByKII_C_U, args);"}, {"target_line_num": 3981, "target_line_code": "finderCache.removeResult(_finderPathFetchByKII_C_U, args);"}, {"target_line_num": 4370, "target_line_code": "clearUniqueFindersCache(kaleoInstanceModelImpl, false);"}, {"target_line_num": 4371, "target_line_code": "cacheUniqueFindersCache(kaleoInstanceModelImpl);"}, {"target_line_num": 4763, "target_line_code": "_finderPathFetchByKII_C_U = new FinderPath("}, {"target_line_num": 4764, "target_line_code": "entityCacheEnabled, finderCacheEnabled, KaleoInstanceImpl.class,"}, {"target_line_num": 4765, "target_line_code": "FINDER_CLASS_NAME_ENTITY, \"fetchByKII_C_U\","}, {"target_line_num": 4766, "target_line_code": "new String[] {"}, {"target_line_num": 4767, "target_line_code": "Long.class.getName(), Long.class.getName(), Long.class.getName()"}, {"target_line_num": 4768, "target_line_code": "},"}, {"target_line_num": 4769, "target_line_code": "KaleoInstanceModelImpl.KALEOINSTANCEID_COLUMN_BITMASK |"}, {"target_line_num": 4770, "target_line_code": "KaleoInstanceModelImpl.COMPANYID_COLUMN_BITMASK |"}, {"target_line_num": 4771, "target_line_code": "KaleoInstanceModelImpl.USERID_COLUMN_BITMASK);"}, {"target_line_num": 4773, "target_line_code": "_finderPathCountByKII_C_U = new FinderPath("}, {"target_line_num": 4774, "target_line_code": "entityCacheEnabled, finderCacheEnabled, Long.class,"}, {"target_line_num": 4775, "target_line_code": "FINDER_CLASS_NAME_LIST_WITHOUT_PAGINATION, \"countByKII_C_U\","}, {"target_line_num": 4776, "target_line_code": "new String[] {"}, {"target_line_num": 4777, "target_line_code": "Long.class.getName(), Long.class.getName(), Long.class.getName()"}, {"target_line_num": 4778, "target_line_code": "});"}], "removed_line": [], "filename": "modules/apps/portal-workflow/portal-workflow-kaleo-service/src/main/java/com/liferay/portal/workflow/kaleo/service/persistence/impl/KaleoInstancePersistenceImpl.java", "patch_func": "no", "diff_file": "liferay-portal_CVE-2021-33333_022705735116e82457526e9a13a36557b7e09f3f.diff", "patch_tag": "7.4.2-ga3", "source_tag": "7.4.1-ga2"}]