[{"cve_id": "liferay-portal", "added_line": [{"target_line_num": 2, "target_line_code": "/**"}, {"target_line_num": 3, "target_line_code": "* Copyright (c) 2000-present Liferay, Inc. All rights reserved."}, {"target_line_num": 4, "target_line_code": "*"}, {"target_line_num": 5, "target_line_code": "* This library is free software; you can redistribute it and/or modify it under"}, {"target_line_num": 6, "target_line_code": "* the terms of the GNU Lesser General Public License as published by the Free"}, {"target_line_num": 7, "target_line_code": "* Software Foundation; either version 2.1 of the License, or (at your option)"}, {"target_line_num": 8, "target_line_code": "* any later version."}, {"target_line_num": 9, "target_line_code": "*"}, {"target_line_num": 10, "target_line_code": "* This library is distributed in the hope that it will be useful, but WITHOUT"}, {"target_line_num": 11, "target_line_code": "* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS"}, {"target_line_num": 12, "target_line_code": "* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more"}, {"target_line_num": 13, "target_line_code": "* details."}, {"target_line_num": 14, "target_line_code": "*/"}, {"target_line_num": 16, "target_line_code": "package com.liferay.oauth2.provider.client.test;"}, {"target_line_num": 18, "target_line_code": "import com.liferay.arquillian.extension.junit.bridge.junit.Arquillian;"}, {"target_line_num": 19, "target_line_code": "import com.liferay.portal.kernel.model.User;"}, {"target_line_num": 20, "target_line_code": "import com.liferay.portal.kernel.test.rule.AggregateTestRule;"}, {"target_line_num": 21, "target_line_code": "import com.liferay.portal.kernel.test.util.UserTestUtil;"}, {"target_line_num": 22, "target_line_code": "import com.liferay.portal.kernel.util.PortalUtil;"}, {"target_line_num": 23, "target_line_code": "import com.liferay.portal.test.rule.LiferayIntegrationTestRule;"}, {"target_line_num": 25, "target_line_code": "import java.util.Collections;"}, {"target_line_num": 27, "target_line_code": "import javax.ws.rs.client.Invocation;"}, {"target_line_num": 28, "target_line_code": "import javax.ws.rs.client.WebTarget;"}, {"target_line_num": 29, "target_line_code": "import javax.ws.rs.core.Response;"}, {"target_line_num": 31, "target_line_code": "import org.junit.Assert;"}, {"target_line_num": 32, "target_line_code": "import org.junit.ClassRule;"}, {"target_line_num": 33, "target_line_code": "import org.junit.Rule;"}, {"target_line_num": 34, "target_line_code": "import org.junit.Test;"}, {"target_line_num": 35, "target_line_code": "import org.junit.runner.RunWith;"}, {"target_line_num": 37, "target_line_code": "import org.osgi.framework.BundleActivator;"}, {"target_line_num": 39, "target_line_code": "/**"}, {"target_line_num": 40, "target_line_code": "* @author Marta Medio"}, {"target_line_num": 41, "target_line_code": "*/"}, {"target_line_num": 42, "target_line_code": "@RunWith(Arquillian.class)"}, {"target_line_num": 43, "target_line_code": "public class CORSApplicationClientTest extends BaseClientTestCase {"}, {"target_line_num": 45, "target_line_code": "@ClassRule"}, {"target_line_num": 46, "target_line_code": "@Rule"}, {"target_line_num": 47, "target_line_code": "public static final AggregateTestRule aggregateTestRule ="}, {"target_line_num": 48, "target_line_code": "new LiferayIntegrationTestRule();"}, {"target_line_num": 50, "target_line_code": "@Test"}, {"target_line_num": 51, "target_line_code": "public void testInvalidCORSRequest() throws Exception {"}, {"target_line_num": 52, "target_line_code": "WebTarget webTarget = getJsonWebTarget(\"user\", \"get-current-user\");"}, {"target_line_num": 54, "target_line_code": "String tokenString = \"wrong-token\";"}, {"target_line_num": 56, "target_line_code": "Invocation.Builder invocationBuilder = authorize("}, {"target_line_num": 57, "target_line_code": "webTarget.request(), tokenString);"}, {"target_line_num": 59, "target_line_code": "invocationBuilder.header(\"Origin\", _TEST_CORS_URI);"}, {"target_line_num": 61, "target_line_code": "Response response = invocationBuilder.get();"}, {"target_line_num": 63, "target_line_code": "String corsHeaderString = response.getHeaderString("}, {"target_line_num": 64, "target_line_code": "\"Access-Control-Allow-Origin\");"}, {"target_line_num": 66, "target_line_code": "Assert.assertNotEquals(_TEST_CORS_URI, corsHeaderString);"}, {"target_line_num": 69, "target_line_code": "@Test"}, {"target_line_num": 70, "target_line_code": "public void testValidCORSRequest() throws Exception {"}, {"target_line_num": 71, "target_line_code": "WebTarget webTarget = getJsonWebTarget(\"user\", \"get-current-user\");"}, {"target_line_num": 73, "target_line_code": "String tokenString = getToken("}, {"target_line_num": 74, "target_line_code": "\"oauthTestApplicationRO\", null,"}, {"target_line_num": 75, "target_line_code": "getResourceOwnerPasswordBiFunction(\"test@liferay.com\", \"test\"),"}, {"target_line_num": 76, "target_line_code": "this::parseTokenString);"}, {"target_line_num": 78, "target_line_code": "Invocation.Builder invocationBuilder = authorize("}, {"target_line_num": 79, "target_line_code": "webTarget.request(), tokenString);"}, {"target_line_num": 81, "target_line_code": "invocationBuilder.header(\"Origin\", _TEST_CORS_URI);"}, {"target_line_num": 83, "target_line_code": "Response response = invocationBuilder.get();"}, {"target_line_num": 85, "target_line_code": "String corsHeaderString = response.getHeaderString("}, {"target_line_num": 86, "target_line_code": "\"Access-Control-Allow-Origin\");"}, {"target_line_num": 88, "target_line_code": "Assert.assertEquals(_TEST_CORS_URI, corsHeaderString);"}, {"target_line_num": 91, "target_line_code": "public static class CORSApplicationTestPreparatorBundleActivator"}, {"target_line_num": 92, "target_line_code": "extends BaseTestPreparatorBundleActivator {"}, {"target_line_num": 94, "target_line_code": "@Override"}, {"target_line_num": 95, "target_line_code": "protected void prepareTest() throws Exception {"}, {"target_line_num": 96, "target_line_code": "long defaultCompanyId = PortalUtil.getDefaultCompanyId();"}, {"target_line_num": 98, "target_line_code": "User user = UserTestUtil.getAdminUser(defaultCompanyId);"}, {"target_line_num": 100, "target_line_code": "createOAuth2Application("}, {"target_line_num": 101, "target_line_code": "defaultCompanyId, user, \"oauthTestApplicationRO\","}, {"target_line_num": 102, "target_line_code": "Collections.singletonList(\"everything.read\"));"}, {"target_line_num": 107, "target_line_code": "@Override"}, {"target_line_num": 108, "target_line_code": "protected BundleActivator getBundleActivator() {"}, {"target_line_num": 109, "target_line_code": "return new CORSApplicationTestPreparatorBundleActivator();"}], "removed_line": [], "filename": "modules/apps/oauth2-provider/oauth2-provider-test/src/testIntegration/java/com/liferay/oauth2/provider/client/test/CORSApplicationClientTest.java", "patch_func": "no", "diff_file": "liferay-portal_CVE-2021-33330_0d49f289f4b955200e3af28d1eebb93603593df8.diff", "patch_tag": "7.4.2-ga3", "source_tag": "7.4.1-ga2"}]