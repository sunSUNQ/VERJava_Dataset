[{"cve_id": "liferay-portal", "added_line": [{"target_line_num": 2, "target_line_code": "/**"}, {"target_line_num": 3, "target_line_code": "* Copyright (c) 2000-present Liferay, Inc. All rights reserved."}, {"target_line_num": 4, "target_line_code": "*"}, {"target_line_num": 5, "target_line_code": "* This library is free software; you can redistribute it and/or modify it under"}, {"target_line_num": 6, "target_line_code": "* the terms of the GNU Lesser General Public License as published by the Free"}, {"target_line_num": 7, "target_line_code": "* Software Foundation; either version 2.1 of the License, or (at your option)"}, {"target_line_num": 8, "target_line_code": "* any later version."}, {"target_line_num": 9, "target_line_code": "*"}, {"target_line_num": 10, "target_line_code": "* This library is distributed in the hope that it will be useful, but WITHOUT"}, {"target_line_num": 11, "target_line_code": "* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS"}, {"target_line_num": 12, "target_line_code": "* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more"}, {"target_line_num": 13, "target_line_code": "* details."}, {"target_line_num": 14, "target_line_code": "*/"}, {"target_line_num": 16, "target_line_code": "package com.liferay.portal.upgrade.v7_0_1;"}, {"target_line_num": 18, "target_line_code": "import com.liferay.portal.kernel.upgrade.UpgradeProcess;"}, {"target_line_num": 19, "target_line_code": "import com.liferay.portal.kernel.util.Base64;"}, {"target_line_num": 20, "target_line_code": "import com.liferay.portal.kernel.util.LoggingTimer;"}, {"target_line_num": 21, "target_line_code": "import com.liferay.util.Encryptor;"}, {"target_line_num": 23, "target_line_code": "import java.security.Key;"}, {"target_line_num": 25, "target_line_code": "import java.sql.PreparedStatement;"}, {"target_line_num": 26, "target_line_code": "import java.sql.ResultSet;"}, {"target_line_num": 28, "target_line_code": "/**"}, {"target_line_num": 29, "target_line_code": "* @author Mika Koivisto"}, {"target_line_num": 30, "target_line_code": "*/"}, {"target_line_num": 31, "target_line_code": "public class UpgradeCompany extends UpgradeProcess {"}, {"target_line_num": 33, "target_line_code": "@Override"}, {"target_line_num": 34, "target_line_code": "protected void doUpgrade() throws Exception {"}, {"target_line_num": 35, "target_line_code": "updateCompanyKey();"}, {"target_line_num": 38, "target_line_code": "protected void updateCompanyKey() throws Exception {"}, {"target_line_num": 39, "target_line_code": "try (LoggingTimer loggingTimer = new LoggingTimer();"}, {"target_line_num": 40, "target_line_code": "PreparedStatement ps = connection.prepareStatement("}, {"target_line_num": 41, "target_line_code": "\"select companyId, key_ from Company\");"}, {"target_line_num": 42, "target_line_code": "ResultSet rs = ps.executeQuery()) {"}, {"target_line_num": 44, "target_line_code": "while (rs.next()) {"}, {"target_line_num": 45, "target_line_code": "String companyId = rs.getString(\"companyId\");"}, {"target_line_num": 46, "target_line_code": "String keyString = rs.getString(\"key_\");"}, {"target_line_num": 48, "target_line_code": "Key key = (Key)Base64.stringToObject(keyString);"}, {"target_line_num": 50, "target_line_code": "keyString = Encryptor.serializeKey(key);"}, {"target_line_num": 52, "target_line_code": "runSQL("}, {"target_line_num": 53, "target_line_code": "\"update Company set key_ = '\" + keyString +"}, {"target_line_num": 54, "target_line_code": "\"' where companyId = \" + companyId);"}], "removed_line": [], "filename": "portal-impl/src/com/liferay/portal/upgrade/v7_0_1/UpgradeCompany.java", "patch_func": "no", "diff_file": "liferay-portal_CVE-2010-5327_c274219e91a092577642117424a3402ff82e73f7.diff", "patch_tag": "7.4.2-ga3", "source_tag": "7.4.1-ga2"}]