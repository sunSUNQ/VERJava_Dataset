[{"cve_id": "liferay-portal", "added_line": [], "removed_line": [{"source_line_num": 2, "source_line_code": "/**"}, {"source_line_num": 3, "source_line_code": "* Copyright (c) 2000-present Liferay, Inc. All rights reserved."}, {"source_line_num": 4, "source_line_code": "*"}, {"source_line_num": 5, "source_line_code": "* This library is free software; you can redistribute it and/or modify it under"}, {"source_line_num": 6, "source_line_code": "* the terms of the GNU Lesser General Public License as published by the Free"}, {"source_line_num": 7, "source_line_code": "* Software Foundation; either version 2.1 of the License, or (at your option)"}, {"source_line_num": 8, "source_line_code": "* any later version."}, {"source_line_num": 9, "source_line_code": "*"}, {"source_line_num": 10, "source_line_code": "* This library is distributed in the hope that it will be useful, but WITHOUT"}, {"source_line_num": 11, "source_line_code": "* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS"}, {"source_line_num": 12, "source_line_code": "* FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more"}, {"source_line_num": 13, "source_line_code": "* details."}, {"source_line_num": 14, "source_line_code": "*/"}, {"source_line_num": 16, "source_line_code": "package com.liferay.portal.cache.multiple.internal.bootstrap;"}, {"source_line_num": 18, "source_line_code": "import com.liferay.petra.string.StringBundler;"}, {"source_line_num": 19, "source_line_code": "import com.liferay.portal.cache.PortalCacheBootstrapLoader;"}, {"source_line_num": 20, "source_line_code": "import com.liferay.portal.kernel.log.Log;"}, {"source_line_num": 21, "source_line_code": "import com.liferay.portal.kernel.log.LogFactoryUtil;"}, {"source_line_num": 22, "source_line_code": "import com.liferay.portal.kernel.util.GetterUtil;"}, {"source_line_num": 24, "source_line_code": "import java.util.Properties;"}, {"source_line_num": 26, "source_line_code": "/**"}, {"source_line_num": 27, "source_line_code": "* @author Tina Tian"}, {"source_line_num": 28, "source_line_code": "*/"}, {"source_line_num": 29, "source_line_code": "public class ClusterLinkPortalCacheBootstrapLoader"}, {"source_line_num": 30, "source_line_code": "implements PortalCacheBootstrapLoader {"}, {"source_line_num": 32, "source_line_code": "public ClusterLinkPortalCacheBootstrapLoader(Properties properties) {"}, {"source_line_num": 33, "source_line_code": "if (properties != null) {"}, {"source_line_num": 34, "source_line_code": "_bootstrapAsynchronously = GetterUtil.getBoolean("}, {"source_line_num": 35, "source_line_code": "properties.getProperty("}, {"source_line_num": 36, "source_line_code": "PortalCacheBootstrapLoader.BOOTSTRAP_ASYNCHRONOUSLY),"}, {"source_line_num": 37, "source_line_code": "PortalCacheBootstrapLoader.DEFAULT_BOOTSTRAP_ASYNCHRONOUSLY);"}, {"source_line_num": 39, "source_line_code": "else {"}, {"source_line_num": 40, "source_line_code": "_bootstrapAsynchronously ="}, {"source_line_num": 41, "source_line_code": "PortalCacheBootstrapLoader.DEFAULT_BOOTSTRAP_ASYNCHRONOUSLY;"}, {"source_line_num": 45, "source_line_code": "@Override"}, {"source_line_num": 46, "source_line_code": "public boolean isAsynchronous() {"}, {"source_line_num": 47, "source_line_code": "return _bootstrapAsynchronously;"}, {"source_line_num": 50, "source_line_code": "@Override"}, {"source_line_num": 51, "source_line_code": "public void loadPortalCache("}, {"source_line_num": 52, "source_line_code": "String portalCacheManagerName, String portalCacheName) {"}, {"source_line_num": 54, "source_line_code": "if (ClusterLinkBootstrapLoaderHelperUtil.isSkipped()) {"}, {"source_line_num": 55, "source_line_code": "return;"}, {"source_line_num": 58, "source_line_code": "if (_bootstrapAsynchronously) {"}, {"source_line_num": 59, "source_line_code": "BootstrapLoaderClientThread bootstrapLoaderClientThread ="}, {"source_line_num": 60, "source_line_code": "new BootstrapLoaderClientThread("}, {"source_line_num": 61, "source_line_code": "portalCacheManagerName, portalCacheName);"}, {"source_line_num": 63, "source_line_code": "bootstrapLoaderClientThread.start();"}, {"source_line_num": 65, "source_line_code": "else {"}, {"source_line_num": 66, "source_line_code": "doLoad(portalCacheManagerName, portalCacheName);"}, {"source_line_num": 70, "source_line_code": "protected void doLoad("}, {"source_line_num": 71, "source_line_code": "String portalCacheManagerName, String portalCacheName) {"}, {"source_line_num": 73, "source_line_code": "if (_log.isDebugEnabled()) {"}, {"source_line_num": 74, "source_line_code": "_log.debug(\"Bootstraping \" + portalCacheName);"}, {"source_line_num": 77, "source_line_code": "try {"}, {"source_line_num": 78, "source_line_code": "ClusterLinkBootstrapLoaderHelperUtil.loadCachesFromCluster("}, {"source_line_num": 79, "source_line_code": "portalCacheManagerName, portalCacheName);"}, {"source_line_num": 81, "source_line_code": "catch (Exception e) {"}, {"source_line_num": 82, "source_line_code": "if (_log.isWarnEnabled()) {"}, {"source_line_num": 83, "source_line_code": "_log.warn(\"Unable to load cache data from the cluster\", e);"}, {"source_line_num": 88, "source_line_code": "private static final Log _log = LogFactoryUtil.getLog("}, {"source_line_num": 89, "source_line_code": "ClusterLinkPortalCacheBootstrapLoader.class);"}, {"source_line_num": 91, "source_line_code": "private final boolean _bootstrapAsynchronously;"}, {"source_line_num": 93, "source_line_code": "private class BootstrapLoaderClientThread extends Thread {"}, {"source_line_num": 95, "source_line_code": "public BootstrapLoaderClientThread("}, {"source_line_num": 96, "source_line_code": "String portalCacheManagerName, String portalCacheName) {"}, {"source_line_num": 98, "source_line_code": "if (_log.isDebugEnabled()) {"}, {"source_line_num": 99, "source_line_code": "_log.debug("}, {"source_line_num": 100, "source_line_code": "StringBundler.concat("}, {"source_line_num": 101, "source_line_code": "\"Bootstrap loader client thread for cache \","}, {"source_line_num": 102, "source_line_code": "portalCacheName, \" from cache manager \","}, {"source_line_num": 103, "source_line_code": "portalCacheManagerName));"}, {"source_line_num": 106, "source_line_code": "_portalCacheManagerName = portalCacheManagerName;"}, {"source_line_num": 107, "source_line_code": "_portalCacheName = portalCacheName;"}, {"source_line_num": 109, "source_line_code": "setDaemon(true);"}, {"source_line_num": 110, "source_line_code": "setName("}, {"source_line_num": 111, "source_line_code": "StringBundler.concat("}, {"source_line_num": 112, "source_line_code": "BootstrapLoaderClientThread.class.getName(), \" - \","}, {"source_line_num": 113, "source_line_code": "portalCacheManagerName, \" - \", portalCacheName));"}, {"source_line_num": 114, "source_line_code": "setPriority(Thread.NORM_PRIORITY);"}, {"source_line_num": 117, "source_line_code": "@Override"}, {"source_line_num": 118, "source_line_code": "public void run() {"}, {"source_line_num": 119, "source_line_code": "try {"}, {"source_line_num": 120, "source_line_code": "doLoad(_portalCacheManagerName, _portalCacheName);"}, {"source_line_num": 122, "source_line_code": "catch (Exception e) {"}, {"source_line_num": 123, "source_line_code": "if (_log.isWarnEnabled()) {"}, {"source_line_num": 124, "source_line_code": "_log.warn(\"Unable to asynchronously stream bootstrap\", e);"}, {"source_line_num": 129, "source_line_code": "private final String _portalCacheManagerName;"}, {"source_line_num": 130, "source_line_code": "private final String _portalCacheName;"}], "filename": "modules/apps/portal-cache/portal-cache-multiple/src/main/java/com/liferay/portal/cache/multiple/internal/bootstrap/ClusterLinkPortalCacheBootstrapLoader.java", "patch_func": "no", "diff_file": "liferay-portal_CVE-2020-15842_571ff47713fed2999a1f5bb80f2eb7b6ed444acf.diff", "patch_tag": "7.4.2-ga3", "source_tag": "7.4.1-ga2"}]