commit 5948f46ed04f7ab0cc5f0b4edd2ca3079751d9a7
Author: Mika Koivisto <mika.koivisto@liferay.com>
Date:   Thu Apr 21 13:26:51 2016 +0300

    LPS-64814 Add verify process

diff --git a/portal-impl/src/com/liferay/portal/verify/VerifyCompany.java b/portal-impl/src/com/liferay/portal/verify/VerifyCompany.java
new file mode 100644
index 000000000000..921a8f410ade
--- /dev/null
+++ b/portal-impl/src/com/liferay/portal/verify/VerifyCompany.java
@@ -0,0 +1,51 @@
+/**
+ * Copyright (c) 2000-present Liferay, Inc. All rights reserved.
+ *
+ * This library is free software; you can redistribute it and/or modify it under
+ * the terms of the GNU Lesser General Public License as published by the Free
+ * Software Foundation; either version 2.1 of the License, or (at your option)
+ * any later version.
+ *
+ * This library is distributed in the hope that it will be useful, but WITHOUT
+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+ * FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more
+ * details.
+ */
+
+package com.liferay.portal.verify;
+
+import com.liferay.portal.kernel.model.Company;
+import com.liferay.portal.kernel.service.CompanyLocalServiceUtil;
+import com.liferay.portal.kernel.util.Base64;
+import com.liferay.portal.kernel.util.LoggingTimer;
+import com.liferay.util.Encryptor;
+
+import java.security.Key;
+
+/**
+ * @author Mika Koivisto
+ */
+public class VerifyCompany extends VerifyProcess {
+
+	@Override
+	protected void doVerify() throws Exception {
+		verifyCompanyKey();
+	}
+
+	protected void verifyCompanyKey() throws Exception {
+		try (LoggingTimer loggingTimer = new LoggingTimer()) {
+			for (Company company : CompanyLocalServiceUtil.getCompanies()) {
+				Key key = (Key)Base64.stringToObjectSilent(company.getKey());
+	
+				if (key != null) {
+					String keyString = Encryptor.serializeKey(key);
+					long companyId = company.getCompanyId();
+
+					runSQL(
+						"update Company set key_ = '" + keyString +
+							"' where companyId = " + companyId);
+				}
+			}
+		}
+	}
+}
diff --git a/portal-impl/src/com/liferay/portal/verify/VerifyProcessSuite.java b/portal-impl/src/com/liferay/portal/verify/VerifyProcessSuite.java
index 71d216d85d64..6fd1b1f34b14 100644
--- a/portal-impl/src/com/liferay/portal/verify/VerifyProcessSuite.java
+++ b/portal-impl/src/com/liferay/portal/verify/VerifyProcessSuite.java
@@ -37,6 +37,7 @@ public class VerifyProcessSuite extends VerifyProcess {
 		verify(new VerifyAsset());
 		verify(new VerifyAuditedModel());
 		verify(new VerifyBlogs());
+		verify(new VerifyCompany());
 		verify(new VerifyGroupedModel());
 		verify(new VerifyLayout());
 		verify(new VerifyMessageBoards());