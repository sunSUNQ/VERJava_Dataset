commit 672385fb5e2a5d712c6fc7d808a272d711bb3315
Author: Javier Gamarra <nhpatt@gmail.com>
Date:   Sat May 30 17:34:59 2020 +0200

    LPS-113779 apply size limits

diff --git a/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java b/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java
index 3fc55e13582e..20c65fc5865d 100644
--- a/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java
+++ b/portal-impl/src/com/liferay/portal/upload/UploadServletRequestImpl.java
@@ -90,6 +90,9 @@ public class UploadServletRequestImpl
 
 			ServletFileUpload servletFileUpload;
 
+			long uploadServletRequestImplMaxSize =
+				UploadServletRequestConfigurationHelperUtil.getMaxSize();
+
 			if (fileSizeThreshold > 0) {
 				servletFileUpload = new ServletFileUpload(
 					new LiferayFileItemFactory(
@@ -97,16 +100,24 @@ public class UploadServletRequestImpl
 			}
 			else {
 				servletFileUpload = new ServletFileUpload(
-					new LiferayFileItemFactory(getTempDir()));
+					new LiferayFileItemFactory(
+						getTempDir(), (int)uploadServletRequestImplMaxSize));
 			}
 
 			if (maxRequestSize > 0) {
 				servletFileUpload.setSizeMax(maxRequestSize);
 			}
+			else {
+				servletFileUpload.setSizeMax(uploadServletRequestImplMaxSize);
+			}
 
 			if (maxFileSize > 0) {
 				servletFileUpload.setFileSizeMax(maxFileSize);
 			}
+			else {
+				servletFileUpload.setFileSizeMax(
+					uploadServletRequestImplMaxSize);
+			}
 
 			liferayServletRequest = new LiferayServletRequest(
 				httpServletRequest);
@@ -116,8 +127,6 @@ public class UploadServletRequestImpl
 
 			liferayServletRequest.setFinishedReadingOriginalStream(true);
 
-			long uploadServletRequestImplMaxSize =
-				UploadServletRequestConfigurationHelperUtil.getMaxSize();
 			long uploadServletRequestImplSize = 0;
 
 			int contentLength = httpServletRequest.getContentLength();