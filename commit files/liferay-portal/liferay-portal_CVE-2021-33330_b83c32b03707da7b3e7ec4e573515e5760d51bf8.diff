commit b83c32b03707da7b3e7ec4e573515e5760d51bf8
Author: Marta Medio <marta.medio@liferay.com>
Date:   Tue Jun 16 16:07:49 2020 +0200

    LPS-113348 Add OAuth2 Preflight CORS test

diff --git a/modules/apps/oauth2-provider/oauth2-provider-test/src/testIntegration/java/com/liferay/oauth2/provider/client/test/CORSApplicationClientTest.java b/modules/apps/oauth2-provider/oauth2-provider-test/src/testIntegration/java/com/liferay/oauth2/provider/client/test/CORSApplicationClientTest.java
index d22ea37de097..d1d4811dbdb4 100644
--- a/modules/apps/oauth2-provider/oauth2-provider-test/src/testIntegration/java/com/liferay/oauth2/provider/client/test/CORSApplicationClientTest.java
+++ b/modules/apps/oauth2-provider/oauth2-provider-test/src/testIntegration/java/com/liferay/oauth2/provider/client/test/CORSApplicationClientTest.java
@@ -23,6 +23,7 @@ import com.liferay.portal.test.rule.LiferayIntegrationTestRule;
 
 import java.util.Collections;
 
+import javax.ws.rs.HttpMethod;
 import javax.ws.rs.client.Invocation;
 import javax.ws.rs.client.WebTarget;
 import javax.ws.rs.core.Response;
@@ -65,6 +66,30 @@ public class CORSApplicationClientTest extends BaseClientTestCase {
 		Assert.assertNotEquals(_TEST_CORS_URI, corsHeaderString);
 	}
 
+	@Test
+	public void testPreflightCORSRequest() throws Exception {
+		WebTarget webTarget = getJsonWebTarget("user", "get-current-user");
+
+		String tokenString = getToken(
+			"oauthTestApplicationRO", null,
+			getResourceOwnerPasswordBiFunction("test@liferay.com", "test"),
+			this::parseTokenString);
+
+		Invocation.Builder invocationBuilder = authorize(
+			webTarget.request(), tokenString);
+
+		invocationBuilder.header(
+			"Access-Control-Request-Method", HttpMethod.OPTIONS);
+		invocationBuilder.header("Origin", _TEST_CORS_URI);
+
+		Response response = invocationBuilder.options();
+
+		String corsHeaderString = response.getHeaderString(
+			"Access-Control-Allow-Origin");
+
+		Assert.assertEquals(_TEST_CORS_URI, corsHeaderString);
+	}
+
 	@Test
 	public void testValidCORSRequest() throws Exception {
 		WebTarget webTarget = getJsonWebTarget("user", "get-current-user");