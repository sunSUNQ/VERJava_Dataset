commit 9ca829c230b4af08bd6e23b330a201cc9a3ca400
Author: Samuel Kong <samuel.kong@liferay.com>
Date:   Thu Dec 31 09:26:20 2009 +0000

    LPS-6034
    
    git-svn-id: svn://svn.liferay.com/repos/public/portal/trunk@43197 05bdf26c-840f-0410-9ced-eb539d925f36

diff --git a/portal-impl/src/com/liferay/portal/service/permission/PortletPermissionImpl.java b/portal-impl/src/com/liferay/portal/service/permission/PortletPermissionImpl.java
index 7869a9794f77..53497b0062aa 100644
--- a/portal-impl/src/com/liferay/portal/service/permission/PortletPermissionImpl.java
+++ b/portal-impl/src/com/liferay/portal/service/permission/PortletPermissionImpl.java
@@ -168,6 +168,10 @@ public class PortletPermissionImpl implements PortletPermission {
 			String actionId, boolean strict)
 		throws PortalException, SystemException {
 
+		if (portlet.isUndeployedPortlet()) {
+			return false;
+		}
+
 		boolean value = contains(
 			permissionChecker, plid, portlet.getPortletId(), actionId, strict);
 
diff --git a/portal-web/docroot/html/portal/render_portlet.jsp b/portal-web/docroot/html/portal/render_portlet.jsp
index 7923afa5fcf6..90b6d59f5b33 100644
--- a/portal-web/docroot/html/portal/render_portlet.jsp
+++ b/portal-web/docroot/html/portal/render_portlet.jsp
@@ -269,7 +269,7 @@ Group group = layout.getGroup();
 
 if (!portletId.equals(PortletKeys.PORTLET_CONFIGURATION)) {
 	if ((!group.hasStagingGroup() || group.isStagingGroup()) &&
-		(PortletPermissionUtil.contains(permissionChecker, plid, portletId, ActionKeys.CONFIGURATION))) {
+		(PortletPermissionUtil.contains(permissionChecker, plid, portlet, ActionKeys.CONFIGURATION))) {
 
 		showConfigurationIcon = true;
 