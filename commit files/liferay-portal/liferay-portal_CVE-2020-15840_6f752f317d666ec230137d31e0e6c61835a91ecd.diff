commit 6f752f317d666ec230137d31e0e6c61835a91ecd
Author: Tomáš Polešovský <tomas.polesovsky@liferay.com>
Date:   Tue Dec 17 18:05:12 2019 +0100

    LPS-57105 Improve

diff --git a/portal-impl/src/com/liferay/portal/util/PortalImpl.java b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
index 2935b119b405..5266b3f6cf29 100644
--- a/portal-impl/src/com/liferay/portal/util/PortalImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/PortalImpl.java
@@ -6408,8 +6408,10 @@ public class PortalImpl implements Portal {
 			return true;
 		}
 
-		if (resourceId.contains("%")) {
-			resourceId = HttpUtil.decodePath(resourceId);
+		if (resourceId.contains("%") &&
+			!isValidResourceId(HttpUtil.decodePath(resourceId))) {
+
+			return false;
 		}
 
 		Matcher matcher = _bannedResourceIdPattern.matcher(resourceId);