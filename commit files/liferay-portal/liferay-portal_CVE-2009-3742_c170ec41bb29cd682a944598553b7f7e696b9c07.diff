commit c170ec41bb29cd682a944598553b7f7e696b9c07
Author: Nate Cavanaugh <nathan.cavanaugh@liferay.com>
Date:   Wed Jan 20 18:20:17 2010 +0000

    LPS-6034 - XSS
    
    git-svn-id: svn://svn.liferay.com/repos/public/portal/trunk@44252 05bdf26c-840f-0410-9ced-eb539d925f36

diff --git a/portal-web/docroot/html/common/themes/top_js.jspf b/portal-web/docroot/html/common/themes/top_js.jspf
index bd6a8464f236..c1722064dbdf 100644
--- a/portal-web/docroot/html/common/themes/top_js.jspf
+++ b/portal-web/docroot/html/common/themes/top_js.jspf
@@ -220,7 +220,7 @@
 		String currentURL = PortalUtil.getCurrentURL(request);
 		%>
 
-		Liferay.currentURL = '<%= UnicodeFormatter.toString(currentURL) %>';
+		Liferay.currentURL = '<%= HtmlUtil.escapeJS(currentURL) %>';
 		Liferay.currentURLEncoded = '<%= HttpUtil.encodeURL(currentURL) %>';
 	// ]]>
 </script>
diff --git a/portal-web/docroot/html/portal/render_portlet.jsp b/portal-web/docroot/html/portal/render_portlet.jsp
index ba5117d5fab7..a5f9221707b4 100644
--- a/portal-web/docroot/html/portal/render_portlet.jsp
+++ b/portal-web/docroot/html/portal/render_portlet.jsp
@@ -967,9 +967,9 @@ else {
 					canEditTitle: <%= showConfigurationIcon %>,
 					columnPos: <%= columnPos %>,
 					isStatic: '<%= staticVar %>',
-					namespacedId: 'p_p_id<%= UnicodeFormatter.toString(renderResponseImpl.getNamespace()) %>',
-					portletId: '<%= UnicodeFormatter.toString(portletDisplay.getId()) %>',
-					refreshURL: '<%= UnicodeFormatter.toString(PortletURLUtil.getRefreshURL(request, themeDisplay)) %>'
+					namespacedId: 'p_p_id<%= HtmlUtil.escapeJS(renderResponseImpl.getNamespace()) %>',
+					portletId: '<%= HtmlUtil.escapeJS(portletDisplay.getId()) %>',
+					refreshURL: '<%= HtmlUtil.escapeJS(PortletURLUtil.getRefreshURL(request, themeDisplay)) %>'
 				}
 			);
 		</aui:script>