commit 2ed872fda7f2a2ee905beb25dab1d8030955c672
Author: Renato Rego <renato.rego@liferay.com>
Date:   Thu May 14 17:14:19 2020 -0300

    LPS-113264 Make sure resource permission exist to allow form publication.

diff --git a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java
index 3eec3850d89b..7521a216ce2a 100644
--- a/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java
+++ b/modules/apps/dynamic-data-mapping/dynamic-data-mapping-form-web/src/main/java/com/liferay/dynamic/data/mapping/form/web/internal/portlet/action/PublishFormInstanceMVCActionCommand.java
@@ -150,11 +150,25 @@ public class PublishFormInstanceMVCActionCommand
 			_portal.getCompanyId(actionRequest), RoleConstants.GUEST);
 
 		ResourcePermission resourcePermission =
-			_resourcePermissionLocalService.getResourcePermission(
+			_resourcePermissionLocalService.fetchResourcePermission(
 				role.getCompanyId(), DDMFormInstance.class.getName(),
 				ResourceConstants.SCOPE_INDIVIDUAL,
 				String.valueOf(formInstanceId), role.getRoleId());
 
+		if (resourcePermission == null) {
+			_resourcePermissionLocalService.setResourcePermissions(
+				role.getCompanyId(), DDMFormInstance.class.getName(),
+				ResourceConstants.SCOPE_INDIVIDUAL,
+				String.valueOf(formInstanceId), role.getRoleId(),
+				new String[] {DDMActionKeys.ADD_FORM_INSTANCE_RECORD});
+
+			resourcePermission =
+				_resourcePermissionLocalService.fetchResourcePermission(
+					role.getCompanyId(), DDMFormInstance.class.getName(),
+					ResourceConstants.SCOPE_INDIVIDUAL,
+					String.valueOf(formInstanceId), role.getRoleId());
+		}
+
 		if (published) {
 			resourcePermission.addResourceAction(
 				DDMActionKeys.ADD_FORM_INSTANCE_RECORD);