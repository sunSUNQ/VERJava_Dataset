commit e5046911c57e60a1d6d8aca9b21bd9093b0f3763
Author: Daniel Beck <daniel-beck@users.noreply.github.com>
Date:   Wed Aug 1 00:56:12 2018 +0200

    [SECURITY-790]

diff --git a/core/src/main/java/hudson/scheduler/CronTab.java b/core/src/main/java/hudson/scheduler/CronTab.java
index 14c67b9034..120b8bc2a1 100644
--- a/core/src/main/java/hudson/scheduler/CronTab.java
+++ b/core/src/main/java/hudson/scheduler/CronTab.java
@@ -204,7 +204,7 @@ public final class CronTab {
         }
 
         void setTo(Calendar c, int i) {
-            c.set(field,i-offset);
+            c.set(field,Math.min(i-offset, c.getActualMaximum(field)));
         }
 
         void clear(Calendar c) {
diff --git a/core/src/test/java/hudson/scheduler/CronTabTest.java b/core/src/test/java/hudson/scheduler/CronTabTest.java
index e2acaf53ba..cae0fdc7ed 100644
--- a/core/src/test/java/hudson/scheduler/CronTabTest.java
+++ b/core/src/test/java/hudson/scheduler/CronTabTest.java
@@ -314,4 +314,11 @@ public class CronTabTest {
         assertEquals("[35, 56]", times.toString());
     }
 
+    @Issue("SECURITY-790")
+    @Test(timeout = 1000L) public void testLongMonths() throws Exception {
+        Calendar cal = Calendar.getInstance();
+        cal.set(Calendar.MONTH, Calendar.JULY);
+        new CronTab("0 0 31 7 *").floor(cal); // would infinite loop
+    }
+
 }