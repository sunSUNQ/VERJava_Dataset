commit 6ae32202576a24a7272ed29a4c7c59ac4551d5a7
Author: Matt Sicker <boards@gmail.com>
Date:   Tue Aug 13 07:08:23 2019 -0500

    [JENKINS-58595] Add missing ${h} in rss and atom views (#4148)
    
    * [JENKINS-58595] Add missing ${h} in rss and atom views
    
    Now that l:view was fixed not to output whitespace, these views can be
    updated to directly use l:view. Otherwise, they needed to initialize
    the ${h} Jelly variable which is done via l:view normally.
    
    This fixes a regression introduced in SECURITY-534.
    
    Signed-off-by: Matt Sicker <boards@gmail.com>
    
    * Fix the fix
    
    Signed-off-by: Matt Sicker <boards@gmail.com>

diff --git a/core/src/main/resources/hudson/atom.jelly b/core/src/main/resources/hudson/atom.jelly
index 6a7200641f..ab5dd11906 100644
--- a/core/src/main/resources/hudson/atom.jelly
+++ b/core/src/main/resources/hudson/atom.jelly
@@ -23,38 +23,39 @@ THE SOFTWARE.
 -->
 
 <?jelly escape-by-default='true'?>
-<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler"><st:contentType value="application/atom+xml;charset=UTF-8" /><!-- No whitespace before xml header: -->&lt;?xml version="1.0" encoding="UTF-8"?&gt;
-
-  <!-- ATOM. See http://atompub.org/rfc4287.html for the format -->
-  <feed xmlns="http://www.w3.org/2005/Atom">
-    <title>${title}</title>
-    <link rel="alternate" type="text/html" href="${rootURL}${url}"/>
-
-    <j:choose>
-      <j:when test="${empty(entries)}">
-        <updated>2001-01-01T00:00:00Z</updated>
-      </j:when>
-      <j:otherwise>
-        <updated>${h.xsDate(adapter.getEntryTimestamp(entries[0]))}</updated>
-      </j:otherwise>
-    </j:choose>
-    <author>
-      <name>Jenkins Server</name>
-    </author>
-    <id>urn:uuid:903deee0-7bfa-11db-9fe1-0800200c9a66</id>
-
-    <j:forEach var="e" items="${entries}" >
-      <entry>
-        <title>${adapter.getEntryTitle(e)}</title>
-        <link rel="alternate" type="text/html" href="${rootURL}${h.encode(adapter.getEntryUrl(e))}"/>
-        <id>${adapter.getEntryID(e)}</id>
-        <published>${h.xsDate(adapter.getEntryTimestamp(e))}</published>
-        <updated>${h.xsDate(adapter.getEntryTimestamp(e))}</updated>
-        <j:set var="desc" value="${adapter.getEntryDescription(e)}"/>
-        <j:if test="${desc!=null}">
-          <content>${desc}</content>
-        </j:if>
-      </entry>
-    </j:forEach>
-  </feed>
+<j:jelly xmlns:j="jelly:core" xmlns:l="/lib/layout">
+  <l:view contentType="application/atom+xml;charset=UTF-8"><!-- No whitespace before xml header: -->&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+    <!-- ATOM. See http://atompub.org/rfc4287.html for the format -->
+    <feed xmlns="http://www.w3.org/2005/Atom">
+      <title>${title}</title>
+      <link rel="alternate" type="text/html" href="${rootURL}${url}"/>
+
+      <j:choose>
+        <j:when test="${empty(entries)}">
+          <updated>2001-01-01T00:00:00Z</updated>
+        </j:when>
+        <j:otherwise>
+          <updated>${h.xsDate(adapter.getEntryTimestamp(entries[0]))}</updated>
+        </j:otherwise>
+      </j:choose>
+      <author>
+        <name>Jenkins Server</name>
+      </author>
+      <id>urn:uuid:903deee0-7bfa-11db-9fe1-0800200c9a66</id>
+
+      <j:forEach var="e" items="${entries}" >
+        <entry>
+          <title>${adapter.getEntryTitle(e)}</title>
+          <link rel="alternate" type="text/html" href="${rootURL}${h.encode(adapter.getEntryUrl(e))}"/>
+          <id>${adapter.getEntryID(e)}</id>
+          <published>${h.xsDate(adapter.getEntryTimestamp(e))}</published>
+          <updated>${h.xsDate(adapter.getEntryTimestamp(e))}</updated>
+          <j:set var="desc" value="${adapter.getEntryDescription(e)}"/>
+          <j:if test="${desc!=null}">
+            <content>${desc}</content>
+          </j:if>
+        </entry>
+      </j:forEach>
+    </feed>
+  </l:view>
 </j:jelly>
diff --git a/core/src/main/resources/hudson/rss20.jelly b/core/src/main/resources/hudson/rss20.jelly
index 9919b177fc..8db8633bcb 100644
--- a/core/src/main/resources/hudson/rss20.jelly
+++ b/core/src/main/resources/hudson/rss20.jelly
@@ -23,28 +23,29 @@ THE SOFTWARE.
 -->
 
 <?jelly escape-by-default='true'?>
-<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler"><st:contentType value="text/xml;charset=UTF-8" /><!-- No whitespace before xml header: -->&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:l="/lib/layout">
+  <l:view contentType="text/xml;charset=UTF-8"><!-- No whitespace before xml header: -->&lt;?xml version="1.0" encoding="UTF-8"?&gt;
+    <!-- RSS 2.0 feed. See http://cyber.law.harvard.edu/rss/rss.html for the format -->
+    <rss version="2.0">
+      <channel>
+        <title>${title}</title>
+        <link>${rootURL}${url}</link>
+        <description>${title}</description>
 
-  <!-- RSS 2.0 feed. See http://cyber.law.harvard.edu/rss/rss.html for the format -->
-  <rss version="2.0">
-    <channel>
-      <title>${title}</title>
-      <link>${rootURL}${url}</link>
-      <description>${title}</description>
-
-      <j:forEach var="e" items="${entries}" >
-        <item>
-          <title>${adapter.getEntryTitle(e)}</title>
-          <link>${rootURL}${h.encode(adapter.getEntryUrl(e))}</link>
-          <guid isPermaLink="false">${adapter.getEntryID(e)}</guid>
-          <pubDate>${h.rfc822Date(adapter.getEntryTimestamp(e))}</pubDate>
-          <author><st:out value="${adapter.getEntryAuthor(e)}"/></author>
-          <j:set var="desc" value="${adapter.getEntryDescription(e)}"/>
-          <j:if test="${desc!=null}">
-            <description>${desc}</description>
-          </j:if>
-        </item>
-      </j:forEach>
-    </channel>
-  </rss>
+        <j:forEach var="e" items="${entries}" >
+          <item>
+            <title>${adapter.getEntryTitle(e)}</title>
+            <link>${rootURL}${h.encode(adapter.getEntryUrl(e))}</link>
+            <guid isPermaLink="false">${adapter.getEntryID(e)}</guid>
+            <pubDate>${h.rfc822Date(adapter.getEntryTimestamp(e))}</pubDate>
+            <author><st:out value="${adapter.getEntryAuthor(e)}"/></author>
+            <j:set var="desc" value="${adapter.getEntryDescription(e)}"/>
+            <j:if test="${desc!=null}">
+              <description>${desc}</description>
+            </j:if>
+          </item>
+        </j:forEach>
+      </channel>
+    </rss>
+  </l:view>
 </j:jelly>